{"data":{"allAnantCassandralinks":{"edges":[{"node":{"title":"Tuning Java resources","alternative_id":11157,"content":"<p class=\"shortdesc\">Tuning the Java Virtual Machine (JVM) can improve performance or reduce high memory\n    consumption.</p><p class=\"p\">Tuning the Java Virtual Machine (JVM) can improve performance or reduce high memory\n      consumption. </p><div class=\"p\">On this page:<ul class=\"ul\"><li class=\"li\"><a class=\"xref\" href=\"https://docs.datastax.com/en/dse/5.1/dse-admin/datastax_enterprise/operations/opsTuneJVM.html#opsTuneJVM__about-gc\">About garbage collection</a></li>\n        <li class=\"li\"><a class=\"xref\" href=\"https://docs.datastax.com/en/dse/5.1/dse-admin/datastax_enterprise/operations/opsTuneJVM.html#opsTuneJVM__choose-gc\">Choosing a Java garbage collector</a></li>\n        <li class=\"li\"><a class=\"xref\" href=\"https://docs.datastax.com/en/dse/5.1/dse-admin/datastax_enterprise/operations/opsTuneJVM.html#opsTuneJVM__setting-cms-gc\">Setting CMS as the Java garbage collector</a></li>\n        <li class=\"li\"><a class=\"xref\" href=\"https://docs.datastax.com/en/dse/5.1/dse-admin/datastax_enterprise/operations/opsTuneJVM.html#opsTuneJVM__tuning-the-java-heap\">Determining the heap size</a></li>\n        <li class=\"li\"><a class=\"xref\" href=\"https://docs.datastax.com/en/dse/5.1/dse-admin/datastax_enterprise/operations/opsTuneJVM.html#opsTuneJVM__how-cassandra-uses-memory\">How DataStax Enterprise uses memory</a> - Read first for a better\n          understanding of the settings and recommendations on this page.</li>\n        <li class=\"li\"><a class=\"xref\" href=\"https://docs.datastax.com/en/dse/5.1/dse-admin/datastax_enterprise/operations/opsTuneJVM.html#opsTuneJVM__adjusting_params_for_other_Cassandra_services\">Adjusting JVM parameters for other DataStax Enterprise services</a></li>\n        <li class=\"li\"><a class=\"xref\" href=\"https://docs.datastax.com/en/dse/5.1/dse-admin/datastax_enterprise/operations/opsTuneJVM.html#opsTuneJVM__jmx-options\">Other JMX options</a></li>\n      </ul></div><section class=\"section\" id=\"opsTuneJVM__choose-gc\"><h2 class=\"title sectiontitle\">Choosing a Java garbage collector</h2><div class=\"p\">DataStax Enterprise 5.1 uses the garbage first collector (G1) by default. G1 is recommended\n        for the following reasons:<ul class=\"ul\"><li class=\"li\">Heap sizes from 16 GB to 64 GB. <p class=\"p\">G1 performs better than CMS (concurrent-mark-sweep)\n              for larger heaps because it scans the regions of the heap containing the most garbage\n              objects first, and compacts the heap on-the-go, while CMS stops the application when\n              performing garbage collection.</p></li>\n          <li class=\"li\">The workload is variable, that is, the cluster is performing the different processes\n            all the time.</li>\n          <li class=\"li\">For future proofing, as CMS will be deprecated in Java 9.</li>\n          <li class=\"li\">G1 is easier to configure.</li>\n          <li class=\"li\">G1 is self tuning.</li>\n          <li class=\"li\">You only need to set MAX_HEAP_SIZE.</li>\n        </ul>However, G1 incurs some latency due to profiling.</div><div class=\"p\">CMS is recommended only in the following circumstances:<ul class=\"ul\"><li class=\"li\">You have the time and expertise to manually tune and test garbage collection. <p class=\"p\">Be\n              aware that allocating more memory to the heap can result in diminishing performance as\n              the garbage collection facility increases the amount of database metadata in heap\n              memory.</p></li>\n          <li class=\"li\">Heap sizes are smaller than 16 GB.</li>\n          <li class=\"li\">The workload is fixed, that is, the cluster performs the same processes all the\n            time.</li>\n          <li class=\"li\">The environment requires the lowest latency possible. </li>\n        </ul><p>Note: For help configuring CMS, contact the <a class=\"xref\" href=\"https://www.datastax.com/products/services\" target=\"_blank\">DataStax Services team</a>.</p></div></section><section class=\"section\" id=\"opsTuneJVM__setting-cms-gc\"><h2 class=\"title sectiontitle\">Setting CMS as the Java garbage collector</h2><ol class=\"ol\"><li class=\"li\">Open .</li>\n        <li class=\"li\">Comment out all lines in the <code data-swiftype-name=\"codeph\" data-swiftype-type=\"text\" class=\"ph codeph\">### GI Settings</code> section.</li>\n        <li class=\"li\">Uncomment all the <code data-swiftype-name=\"codeph\" data-swiftype-type=\"text\" class=\"ph codeph\">### CMS Settings</code> section</li>\n      </ol></section><section class=\"section\" id=\"opsTuneJVM__tuning-the-java-heap\"><h2 class=\"title sectiontitle\">Determining the heap size</h2><div class=\"p\">The database automatically calculates the maximum heap size (MAX_HEAP_SIZE) based on this\n        formula:<pre>max(min(1/2 ram, 1024 megabytes), min(1/4 ram, 32765 megabytes))</pre></div><div class=\"p\">For\n        production use, use these guidelines to adjust heap size for your environment:<ul class=\"ul\"><li class=\"li\">Heap size is usually between ¼ and ½ of system memory.</li>\n          <li class=\"li\">Do not devote all memory to heap because it is also used for offheap cache and file\n            system cache.</li>\n          <li class=\"li\">Always enable GC logging when adjusting GC.</li>\n          <li class=\"li\">Adjust settings gradually and test each incremental change.</li>\n          <li class=\"li\">Enable parallel processing for GC, particularly when using DSE Search.</li>\n          <li class=\"li\">The GCInspector class logs information about any garbage collection\n            that takes longer than 200 ms. Garbage collections that occur frequently and take a\n            moderate length of time (seconds) to complete, indicate excessive garbage collection\n            pressure on the JVM. In addition to adjusting the garbage collection options, other\n            remedies include adding nodes, and lowering cache sizes.</li>\n          <li class=\"li\">For a node using G1, DataStax recommends a MAX_HEAP_SIZE as large as possible, up to\n            64 GB.</li>\n        </ul><p>Note:  For more tuning tips, see <a class=\"xref\" href=\"http://blog.ragozin.info/2012/03/secret-hotspot-option-improving-gc.html\" target=\"_blank\">Secret HotSpot option improving GC pauses on large\n            heaps</a>.</p></div><p class=\"p\"><strong class=\"ph b\">MAX_HEAP_SIZE</strong></p><div class=\"p\">The recommended maximum heap size\n        depends on which GC is used:<table class=\"table frame-all\"><caption>G1 for newer computers (8+ cores) with up to 256 GB RAM\n                16 GB to 32765 MB.See <a class=\"xref\" href=\"http://java-performance.info/over-32g-heap-java\" target=\"_blank\">Java performance tuning</a>.\n              CMS for newer computers (8+ cores) with up to 256 GB RAM\n                No more 16 GB.\n              Older computers\n                Typically 8 GB.\n              </caption></table></div><div class=\"p\">The easiest way to determine the optimum heap size for your environment is:<ol class=\"ol\"><li class=\"li\">Set the maximum heap size in the  file to\n            a high arbitrary value on a single node. For example, when using\n              G1:<pre>-Xms48G\n-Xmx48G</pre><p class=\"p\">Set the min (-Xms) and max (-Xmx) heap\n              sizes to the same value to avoid stop-the-world GC pauses during resize, and to lock\n              the heap in memory on startup which prevents any of it from being swapped\n            out.</p></li>\n          <li class=\"li\">Enable GC logging.</li>\n          <li class=\"li\">Check the logs to view the heap used by that node and use that value for setting the\n            heap size in the cluster:</li>\n        </ol><p>Note: This method decreases performance for the test node, but generally does not\n          significantly reduce cluster performance.</p></div><p class=\"p\">If you don't see improved performance, contact the <a class=\"xref\" href=\"https://www.datastax.com/products/services\" target=\"_blank\">DataStax\n          Services team</a> for additional help.</p><p class=\"p\"><strong class=\"ph b\">HEAP_NEWSIZE</strong></p><div class=\"p\">For CMS, you may also need to adjust HEAP_NEWSIZE. This setting determines the amount of\n        heap memory allocated to newer objects or<em class=\"ph i\">young generation</em>. The database calculates\n        the default value for this property in megabytes (MB) as the lesser of:<ul class=\"ul\"><li class=\"li\">100 times the number of cores</li>\n          <li class=\"li\">¼ of MAX_HEAP_SIZE</li>\n        </ul></div><div class=\"p\">As a starting point, set HEAP_NEWSIZE to 100 MB per physical CPU core. For\n        example, for a modern 8-core+ machine:<pre>-Xmn800M</pre></div><p class=\"p\">A larger\n        HEAP_NEWSIZE leads to longer GC pause times. For a smaller HEAP_NEWSIZE, GC pauses are\n        shorter but usually more expensive.</p>See<a class=\"xref\" href=\"https://docs.datastax.com/en/dse-planning/doc/planning/planningHardware.html#planningHardware__memory\" target=\"_blank\">Recommended minimum memory for dedicated hardware and virtual\n        environments</a>.</section><section class=\"section\" id=\"opsTuneJVM__how-cassandra-uses-memory\"><h2 class=\"title sectiontitle\">How DataStax Enterprise uses memory</h2><div class=\"p\">The database performs the following major operations within JVM heap:<ul class=\"ul\" id=\"opsTuneJVM__ul_enc_3dg_vw\"><li class=\"li\">To perform reads, the database maintains the following components in heap memory:<ul class=\"ul\"><li class=\"li\">Bloom filters</li>\n              <li class=\"li\">Partition summary</li>\n              <li class=\"li\">Partition key cache</li>\n              <li class=\"li\">Compression offsets</li>\n              <li class=\"li\">SSTable index summary</li>\n            </ul><p class=\"p\">This metadata resides in memory and is proportional to total data. Some of the\n              components <a class=\"xref\" href=\"https://docs.datastax.com/en/dse/5.1/dse-arch/datastax_enterprise/dbInternals/dbIntAboutReads.html\" target=\"_blank\">grow proportionally to the size of total\n                memory</a>.</p></li>\n          <li class=\"li\">The database gathers replicas for a read or for anti-entropy repair and compares the\n            replicas in heap memory.</li>\n          <li class=\"li\">Data written to the database is first stored in memtables in heap memory. Memtables\n            are flushed to SSTables on disk.</li>\n        </ul></div><div class=\"p\">To improve performance, the database also uses off-heap memory as follows:<ul class=\"ul\" id=\"opsTuneJVM__ul_uxp_c2g_vw\"><li class=\"li\">Page cache. The database uses additional memory as page cache when reading files on\n            disk.</li>\n          <li class=\"li\">The Bloom filter and compression offset maps reside off-heap.</li>\n          <li class=\"li\">The database can store cached rows in native memory, outside the Java heap. This\n            reduces JVM heap requirements, which helps keep the heap size in the sweet spot for JVM\n            garbage collection performance. </li>\n        </ul></div></section><section class=\"section\" id=\"opsTuneJVM__adjusting_params_for_other_Cassandra_services\"><h2 class=\"title sectiontitle\">Adjusting JVM parameters for other DataStax Enterprise services</h2><ul class=\"ul\"><li class=\"li\"><strong class=\"ph b\">DSE Search</strong>: Some users have reported that increasing the stack size improves\n          performance under Tomcat. <div class=\"p\">To increase the stack size, uncomment and modify the default\n            setting in thefile.<pre># Per-thread stack size.\nJVM_OPTS=\"$JVM_OPTS -Xss256k\"</pre>Also,\n            decreasing the memtable space to make room for search caches can improve performance.\n            Modify the memtable space by changing the<a class=\"xref\" href=\"https://docs.datastax.com/en/dse/5.1/dse-admin/datastax_enterprise/config/configCassandra_yaml.html#configCassandra_yaml__memtable_heap_space_in_mb\">memtable_heap_space_in_mb</a>and<a class=\"xref\" href=\"https://docs.datastax.com/en/dse/5.1/dse-admin/datastax_enterprise/config/configCassandra_yaml.html#configCassandra_yaml__memtable_offheap_space_in_mb\">memtable_offheap_space_in_mb</a>properties in thefile.</div></li>\n        <li class=\"li\">\n          <p class=\"p\"><strong class=\"ph b\">MapReduce</strong>: Because MapReduce runs outside the JVM, changes to the JVM do not\n            affect Analytics/Hadoop operations directly.</p>\n        </li>\n      </ul></section><section class=\"section\" id=\"opsTuneJVM__jmx-options\"><h2 class=\"title sectiontitle\">Other JMX options</h2><p class=\"p\">DataStax Enterprise exposes other statistics and management operations via Java Management\n        Extensions (JMX). <a class=\"xref\" href=\"https://docs.datastax.com/en/dse/5.1/dse-admin/datastax_enterprise/operations/opsMonitoring.html#opsMonitoringJconsole\">JConsole</a>, the <a class=\"xref\" href=\"https://docs.datastax.com/en/dse/5.1/dse-admin/datastax_enterprise/operations/opsMonitoring.html#opsMonitorNodetool\" title=\"Get statistics using nodetool commands.\">nodetool</a> are JMX-compliant management tools.</p><p class=\"p\">Configure the database for JMX management by editing these properties in\n        .</p><ul class=\"ul\"><li class=\"li\">com.sun.management.jmxremote.port: sets the port on which the\n          database listens from JMX connections. </li>\n        <li class=\"li\">com.sun.management.jmxremote.ssl: enables or disables SSL for JMX. </li>\n        <li class=\"li\">com.sun.management.jmxremote.authenticate: enables or disables remote\n          authentication for JMX. </li>\n        <li class=\"li\">-Djava.rmi.server.hostname: sets the interface hostname or IP that\n          JMX should use to connect. Uncomment and set if you are having trouble connecting. </li>\n      </ul><p>Note: By default, you can interact with DataStax Enterprise using JMX on port 7199 without\n        authentication.</p></section><section class=\"section\"></section>"}}]}},"pageContext":{"alternative_id":11157}}