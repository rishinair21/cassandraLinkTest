{"data":{"allAnantCassandralinks":{"edges":[{"node":{"title":"Cassandra Log Tools","alternative_id":4882,"content":"<h2><a href=\"https://github.com/erickramirezDSE/cass_log_tools#description\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-description\"></a>Description</h2><p>Simple scripts for working with Apache Cassandra logs.</p><h2><a href=\"https://github.com/erickramirezDSE/cass_log_tools#overview\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-overview\"></a>Overview</h2><p>These are scripts I created to make it simpler to read/summarise/parse the <code>system.log</code>.</p><p>They were intended to be overly simple for readability and for portability, i.e. they can just run on any machine that can run Bourne shell or Perl without having to download additional modules or plugins.</p><h2><a href=\"https://github.com/erickramirezDSE/cass_log_tools#scripts\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-scripts\"></a>Scripts</h2><h4><a href=\"https://github.com/erickramirezDSE/cass_log_tools#compaction_ratesh\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-compaction_ratesh\"></a><code>compaction_rate.sh</code></h4><p>Extracts the compaction throughput from a Cassandra <code>system.log</code>.</p><p>Use this script to get a feel for the compaction in MB/s.</p><p>Usage: <code>compaction_rate.sh &lt;system_log&gt; [min_data_size_bytes]</code></p><p>Sample output:</p><pre>$ compaction_rate.sh system.log 20000000\n  Throughput: 16.228230MB/s. | Data size: 38798031 (37 MB) | SSTables count: 2\n  Throughput: 15.939397MB/s. | Data size: 41834507 (39 MB) | SSTables count: 2\n  Throughput: 15.885001MB/s. | Data size: 45639407 (43 MB) | SSTables count: 2\n</pre><h4><a href=\"https://github.com/erickramirezDSE/cass_log_tools#count_entries_per_hoursh\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-count_entries_per_hoursh\"></a><code>count_entries_per_hour.sh</code></h4><p>Counts the occurrences of a string for each hour in the Cassandra <code>system.log</code>.</p><p>Use this script to work out whether load has increased during a particular period.</p><p>Useful query strings:</p><ul><li>\"ParNew\" - shows distribution of GC pauses</li>\n<li>\"Compacted\" - shows distribution of compaction activity</li>\n<li>\"flush of Memtable\" - shows flushing activity, indicates traffic</li>\n<li>\"ConcurrentMarkSweep\" - indicates GC pressure</li>\n<li>\"Started hinted handoff\" - indicates existence of unresponsive nodes</li>\n</ul><p>Sample output:</p><pre>$ count_entries_per_hour.sh ParNew system.log\n2015-04-28 12:00 - 8\n2015-04-28 16:00 - 108\n2015-04-28 20:00 - 202\n</pre><h4><a href=\"https://github.com/erickramirezDSE/cass_log_tools#display_large_rowssh\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-display_large_rowssh\"></a><code>display_large_rows.sh</code></h4><p>Displays entries in Cassandra logs relating to compaction of large rows.</p><p>Useful for showing rows larger than a given size, e.g. 100MB.</p><p>Usage: <code>display_large_rows.sh &lt;system_log&gt; [min_row_size_bytes]</code></p><p>Sample output:</p><pre>$ display_large_rows.sh system.log 1000000000\nINFO [CompactionExecutor:73] 2015-01-14 19:11:45,959 CompactionController.java (line 192) Compacting large row myKS/myCF:8e6fb0b72937 (1407625692 bytes) incrementally | 1342 MB\nINFO [CompactionExecutor:73] 2015-01-14 19:13:09,901 CompactionController.java (line 192) Compacting large row myKS/myCF:2eec906de37b (1410187132 bytes) incrementally | 1344 MB\nINFO [CompactionExecutor:73] 2015-01-14 19:14:34,765 CompactionController.java (line 192) Compacting large row myKS/myCF:ce49043461ce (2871138316 bytes) incrementally | 2738 MB\n</pre><h4><a href=\"https://github.com/erickramirezDSE/cass_log_tools#initial_log_assesssh\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-initial_log_assesssh\"></a><code>initial_log_assess.sh</code></h4><p>A script I use to do a quick assessment of a Cassandra node. It highlights restarts, GC activity, dropped mutations, large rows, errors, etc.</p><p>Usage: <code>initial_log_assess.sh system.log</code></p><h4><a href=\"https://github.com/erickramirezDSE/cass_log_tools#rename_node_dirssh\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-rename_node_dirssh\"></a><code>rename_node_dirs.sh</code></h4><p>The directory names for nodes in the OpsCenter Diagnostic tarball are quite long so I wrote this script to simplify them to just the IP address of the nodes.</p><p>Usage: <code>cd &lt;diagnostic_dir&gt;/nodes &amp;&amp; rename_node_dirs.sh</code></p><p>Sample output:</p><pre>$ rename_node_dirs.sh \nRenaming [opsc-2015-04-29-11-54-21-UTC-172.31.3.100] to [172.31.3.100]... OK\nRenaming [opsc-2015-04-29-11-54-21-UTC-172.31.36.54] to [172.31.36.54]... OK\nRenaming [opsc-2015-04-29-11-54-21-UTC-172.31.43.125] to [172.31.43.125]... OK\n</pre><h4><a href=\"https://github.com/erickramirezDSE/cass_log_tools#summarise_log_casspl\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-summarise_log_casspl\"></a><code>summarise_log_cass.pl</code></h4><p>Summarises a Cassandra log file into line counts by message type, thread names, classes and de-personalised messages.</p><p>Usage: <code>summarise_log_cass.pl -f system.log</code></p><p>Sample output:</p><pre>===== Summarising log file [system_678571075.log] =====\n===== Count of message entries by log level =====\n    15708 --- INFO \n      311 --- WARN \n===== Count of message entries by thread =====\n     9871 --- [ScheduledTasks] \n     1512 --- [FlushWriter] \n     1263 --- [MemoryMeter] \n     1068 --- [RequestResponseStage] \n      814 --- [CompactionExecutor] \n      305 --- [HANDSHAKE#.#.#.#/#.#.#.#] \n      279 --- [WRITE-/#.#.#.#] \n      228 --- [main] \n      219 --- [HintedHandoff] \n...\n===== Count of message entries by class =====\n     9239 --- StatusLogger.java \n     2775 --- Memtable.java \n     1233 --- Gossiper.java \n      808 --- ColumnFamilyStore.java \n      593 --- CompactionTask.java \n      305 --- OutboundTcpConnection.java \n      280 --- SSLFactory.java \n      202 --- HintedHandOffManager.java \n      118 --- GCInspector.java \n...\n===== Count of message entries =====\n     9239 --- INFO [ScheduledTasks] StatusLogger.java ... \n     1234 --- INFO [MemoryMeter] Memtable.java CFS(Keyspace='...') liveRatio is #.# (just-counted was #.#).  calculation took #ms for # cells \n     1067 --- INFO [RequestResponseStage] Gossiper.java InetAddress /#.#.#.# is now UP \n      756 --- INFO [FlushWriter] Memtable.java Writing Memtable-&lt;table&gt;@#(#/# serialized/live bytes, # ops) \n      743 --- INFO [FlushWriter] Memtable.java Completed flushing &lt;db_file&gt; (# bytes) for commitlog position ReplayPosition(segmentId=#, position=#) \n      500 --- INFO [ScheduledTasks] ColumnFamilyStore.java Enqueuing flush of Memtable-&lt;table&gt; \n      298 --- INFO [CompactionExecutor] CompactionTask.java Compacting [SSTableReader(path=&lt;sstable_files&gt;), ...] \n      295 --- INFO [CompactionExecutor] CompactionTask.java Compacted # to [&lt;sstable_files&gt;]... \n      279 --- INFO [HANDSHAKE#.#.#.#/#.#.#.#] OutboundTcpConnection.java Handshaking version with #.#.#.#/#.#.#.# \n      279 --- WARN [WRITE-/#.#.#.#] SSLFactory.java Filtering out TLS_RSA_WITH_AES_#_CBC_SHA,TLS_DHE_RSA_WITH_AES_#_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_#_CBC_SHA as it isnt supported by the socket \n      155 --- INFO [GossipTasks] Gossiper.java InetAddress /#.#.#.# is now DOWN \n      106 --- INFO [ScheduledTasks] GCInspector.java GC for ConcurrentMarkSweep: # ms for # collections, # used; max is # \n      100 --- INFO [HintedHandoff] HintedHandOffManager.java Started hinted handoff for host: UUID with IP: /#.#.#.#\n...\n</pre><h4><a href=\"https://github.com/erickramirezDSE/cass_log_tools#show_log_rangessh\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-show_log_rangessh\"></a><code>show_log_ranges.sh</code></h4><p>This script is also run from the nodes directory, it will look for \"system.log\" files and then grab the first and last lines with the date string in them. The idea is to give the user the range the logs cover</p><h4><a href=\"https://github.com/erickramirezDSE/cass_log_tools#nodeuptime\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-nodeuptime\"></a><code>nodeuptime</code></h4><p>This script takes input from <code>nodetool info</code> and prints the nodes uptime in a more 'friendly' format .\nUseful to see how long has been up when looking at other nodetool commands.</p>"}}]}},"pageContext":{"alternative_id":4882}}