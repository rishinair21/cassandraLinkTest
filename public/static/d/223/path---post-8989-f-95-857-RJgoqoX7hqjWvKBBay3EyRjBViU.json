{"data":{"allAnantCassandralinks":{"edges":[{"node":{"title":"cyngn/ChronoServer","alternative_id":8989,"content":"<h3>\n      \n      README.md\n    </h3><article class=\"markdown-body entry-content\" itemprop=\"text\"><p><a href=\"https://travis-ci.org/cyngn/ChronoServer\" rel=\"nofollow\"><img src=\"https://camo.githubusercontent.com/b7af716b6bb1fb518d07b96d337300413cd06a3d/68747470733a2f2f7472617669732d63692e6f72672f63796e676e2f4368726f6e6f5365727665722e7376673f6272616e63683d6d6173746572\" alt=\"Build Status\" data-canonical-src=\"https://travis-ci.org/cyngn/ChronoServer.svg?branch=master\" /></a></p>\n<p>A test server for sampling how long it takes mobile &amp; web clients to make various types of requests to a server doing common request patterns. The idea is you can set this server up in various locations (think DCs) around the globe or country and test what the latency and experience for users will be as you vary the size and style of requests. You can also use the server to see how different CDNs might perform when sitting in front of your server and caching content.</p>\n<p>The basic flow is as follows:</p>\n<ul><li>Client gets a collection of URLs to call from server, a mix of GET &amp; POST calls.</li>\n<li>Client executes the URLs timing each one.</li>\n<li>Client reports back to server all the timing data for each call and metadata about the client's connection.</li>\n</ul><h2><a href=\"#getting-started\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-getting-started\"></a>Getting Started</h2>\n<p>####Clone the repo &amp; build</p>\n<div class=\"highlight highlight-source-shell\"><pre>./gradlew clean shadowJar</pre></div>\n<p>####Setup the Cassandra DB</p>\n<p>Options:</p>\n<ul><li>run standalone</li>\n<li>run ccm</li>\n<li>point at your internal cluster</li>\n</ul><p>Execute the scheme file in <strong>db/scheme.cql</strong> on your setup.</p>\n<p>####Configuration</p>\n<p>The server takes the following config</p>\n<div class=\"highlight highlight-source-json\"><pre>{\n    \"port\" : &lt;port&gt;,\n    \"default_test_base_url\" : \"&lt;default http://localhost&gt;\",\n    \"data_retention_seconds\" : &lt;default 86400&gt;,\n    \"cassandra\": {\n        \"seeds\": [\"localhost\"],\n        \"reconnect\": {\n            \"name\": \"exponential\",\n            \"base_delay\": 1000,\n            \"max_delay\": 10000\n        }\n    }\n}</pre></div>\n<p>For example:</p>\n<div class=\"highlight highlight-source-json\"><pre>{\n    \"port\" : 7345,\n    \"default_test_base_url\" : \"http://localhost\",\n    \"data_retention_seconds\" : 86400,\n    \"cassandra\": {\n        \"seeds\": [\"localhost\"],\n        \"reconnect\": {\n            \"name\": \"exponential\",\n            \"base_delay\": 1000,\n            \"max_delay\": 10000\n        }\n    }\n}</pre></div>\n<p>Field breakdown:</p>\n<ul><li><code>port</code> the port the server listens on</li>\n<li><code>default_test_base_url</code> the base url used in creating the bootstrap sample data</li>\n<li><code>data_retention_seconds</code> the seconds to allow the upload test data from users to live in the DB, this defaults to a day.</li>\n<li><code>cassandra</code> The config to initialize the Cassandra driver with, see <a href=\"https://github.com/englishtown/vertx-cassandra\">vertx-cassandra</a> for more details.</li>\n</ul><p>####Running Server</p>\n<div class=\"highlight highlight-source-shell\"><pre>#start the server\njava -jar build/libs/ChronoServer-0.5.0-fat.jar -conf conf.json -instances 2</pre></div>\n<h2><a href=\"#rest-apis\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-rest-apis\"></a>REST APIs</h2>\n<h4><a href=\"#apiv1test_endpoints---get\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-apiv1test_endpoints---get\"></a>/api/v1/test_endpoints - GET</h4>\n<p>Gets a set of URLs for the client to execute.</p>\n<p>Parameters:</p>\n<ul><li><code>test_batch</code> - a named collection of URLs you want to pass back to a client to run. Defaults to the bootstrap collection if not specified.</li>\n</ul><p>Response:</p>\n<p>See <a href=\"https://github.com/cyngn/ChronoServer/blob/master/src/main/java/com/cyngn/chrono/http/ConfigResponse.java\">ConfigResponse.java</a></p>\n<p>####/api/v1/report - POST</p>\n<p>Allows a user to upload detailed information on the timings for all the calls it made.</p>\n<p>Parameters:</p>\n<p>See <a href=\"https://github.com/cyngn/ChronoServer/blob/master/src/main/java/com/cyngn/chrono/storage/entity/MetricReport.java\">MetricReport.java</a></p>\n<p>####/api/v1/timing - GET\nSub APIs</p>\n<ul><li>/static - grabs <code>N</code> data from memory</li>\n<li>/static_cached - grabs <code>N</code> data from memory and puts the appropriate cache headers on</li>\n<li>/dynamic - grabs <code>N</code> data from the DB</li>\n<li>/dynamic_cached -  grabs <code>N</code> data from the DB and puts the appropriate cache headers on</li>\n</ul><p>Required Common Parameters:</p>\n<ul><li><code>unit</code> - the unit of the data to get, either <code>kb</code> or <code>mb</code></li>\n<li><code>size</code> - the size of data to get back</li>\n</ul><p>Response:</p>\n<div class=\"highlight highlight-source-json\"><pre>{\n  \"data\" : \"&lt;a bunch of random data matching your parameters&gt;\"\n}</pre></div>\n<p>####/api/v1/timing - POST\nSub APIs</p>\n<ul><li>/store - upload <code>N</code> amount data to the DB, server returns after it is successfully written to Cassandra</li>\n<li>/store_mem - upload <code>N</code> amount data to server memory, server returns after it gets the full body of the post</li>\n</ul><p>Parameters:</p>\n<p>See <a href=\"https://github.com/cyngn/ChronoServer/blob/master/src/main/java/com/cyngn/chrono/http/StorageRequest.java\">StorageRequest.java</a></p>\n<p>####/healthcheck - GET</p>\n<p>Standard health check for things like a LB to hit.</p>\n<p>####/api/v1/timing_streaming - SockJS interface</p>\n<p>See: <a href=\"https://github.com/cyngn/ChronoServer/blob/master/src/main/java/com/cyngn/chrono/http/streaming\">streaming namespace</a> and sample client below.</p>\n<h2><a href=\"#examples\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-examples\"></a>Examples</h2>\n<p>Piping curl output to something like <a href=\"https://github.com/jmhodges/jsonpp\">jsonpp</a> makes it much more readable.</p>\n<p>###curl requests</p>\n<div class=\"highlight highlight-source-shell\"><pre>#start the server\njava -jar build/libs/ChronoServer-0.5.0-fat.jar -conf conf.json -instances 2\n#grab a sample config package, take note of the api_key\ncurl -v \"http://localhost:7345/api/v1/test_endpoints\" | jsonpp\n#grab static data with no caching\ncurl -v --header \"X-API-Key: [api_key here]\" \"http://localhost:7345/api/v1/timing/static?unit=kb&amp;size=1\" | jsonpp\n#grab static data with caching\ncurl -v --header \"X-API-Key: [api_key here]\" \"http://localhost:7345/api/v1/timing/static_cached?unit=kb&amp;size=1\" | jsonpp\n#grab data from the DB with no caching\ncurl -v --header \"X-API-Key: [api_key here]\" \"http://localhost:7345/api/v1/timing/dynamic?unit=kb&amp;size=1\" | jsonpp\n#grab data from the DB with caching\ncurl -v --header \"X-API-Key: [api_key here]\" \"http://localhost:7345/api/v1/timing/dynamic_cached?unit=kb&amp;size=1\" | jsonpp</pre></div>\n<p>For testing POST calls via the store api <a href=\"https://www.getpostman.com/\" rel=\"nofollow\">Postman</a> is great for this.</p>\n<p>###sample SockJS client</p>\n<div class=\"highlight highlight-text-html-basic\"><pre>&lt;html&gt;\n    &lt;script src=\"http:////cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"vertxbus-3.0.0.js\"&gt;&lt;/script&gt;\n    &lt;!-- You're going to want to turn off security in your browser when running this probably --&gt;\n    &lt;script&gt;\n        // this is acquired from the server\n        var apiKey = \"\"\n        var sock = new SockJS('http://localhost:7345/api/v1/timing_streaming');\n        // download via socket\n        var getData = function(address, unit, size) {\n            sock.send(JSON.stringify({address: address, \"api_key\": apiKey,\n                        body : {unit : unit, size: size}}));\n        };\n        // helper func for generating fake data\n        var getKb = function(number) {\n            var data = ['a', 'b', 'c', 'd', 'e', '1', '2', '3', '4', '5'];\n            var str = \"\";\n            var totalKb = 1024 * number;\n            for(var i = 0; i &lt; totalKb; i++) {\n                str += data[Math.floor((Math.random() * 10))];\n            }\n            return str;\n        };\n        // upload via socket\n        var putData = function(size) {\n            sock.send(JSON.stringify({address: \"streaming.store\", \"api_key\": apiKey,\n                        body : {test_batch: \"some_batch\", unit : \"kb\", size: size, data: getKb(size)}}));\n        };\n        // get the config, ie api key\n        var getApiKey = function() {\n            sock.send(JSON.stringify({address: \"streaming.config\", \"api_key\": \"\", body : {}}));\n        }\n        sock.onopen = function() {\n            console.log('connected to server');\n            getApiKey();\n        };\n        sock.onmessage = function(e) {\n            console.log('message', e.data);\n            var data = JSON.parse(e.data);\n            // once we have the api key make some test calls\n            if(data.type == \"streaming.config\") {\n                apiKey = data.api_key;\n                getData('streaming.static', \"kb\", 1);\n                getData('streaming.dynamic', \"kb\", 5);\n                putData(5);\n            }\n        };\n        sock.onclose = function() {\n            console.log('lost connection to server');\n        };\n    &lt;/script&gt;\n    &lt;body&gt;\n    &lt;/body&gt;\n&lt;/html&gt;</pre></div>\n</article>"}}]}},"pageContext":{"alternative_id":8989}}