{"data":{"allAnantCassandralinks":{"edges":[{"node":{"title":"voxpupuli/puppet-cassandra","alternative_id":12452,"content":"<article class=\"markdown-body entry-content\" itemprop=\"text\">\n<p><a href=\"https://travis-ci.org/voxpupuli/puppet-cassandra\" rel=\"nofollow\"><img src=\"https://camo.githubusercontent.com/b8ed4f222bfc86ba147fd1e9295d8b6f90fc94c8/68747470733a2f2f7472617669732d63692e6f72672f766f78707570756c692f7075707065742d63617373616e6472612e706e673f6272616e63683d6d6173746572\" alt=\"Build Status\" data-canonical-src=\"https://travis-ci.org/voxpupuli/puppet-cassandra.png?branch=master\" /></a></p>\n<h2><a id=\"user-content-table-of-contents\" class=\"anchor\" aria-hidden=\"true\" href=\"#table-of-contents\"></a>Table of Contents</h2>\n<ol><li><a href=\"#overview\">Overview</a></li>\n<li><a href=\"#setup\">Setup - The basics of getting started with Cassandra</a>\n<ul><li><a href=\"#what-cassandra-affects\">What Cassandra affects</a></li>\n<li><a href=\"#upgrading\">Upgrading</a></li>\n<li><a href=\"#beginning-with-cassandra\">Beginning with Cassandra</a></li>\n</ul></li>\n<li><a href=\"#usage\">Usage - Configuration options and additional functionality</a>\n<ul><li><a href=\"#setup-a-keyspace-and-users\">Setup a keyspace and users</a></li>\n<li><a href=\"#create-a-cluster-in-a-single-data-center\">Create a Cluster in a Single Data Center</a></li>\n<li><a href=\"#create-a-cluster-in-multiple-data-centers\">Create a Cluster in Multiple Data Centers</a></li>\n<li><a href=\"#datastax-enterprise\">DataStax Enterprise</a></li>\n<li><a href=\"#apache-cassandra\">Apache Cassandra</a></li>\n</ul></li>\n<li><a href=\"#reference\">Reference</a></li>\n<li><a href=\"#limitations\">Limitations - OS compatibility, etc.</a></li>\n<li><a href=\"#development\">Development</a></li>\n</ol><h2><a id=\"user-content-overview\" class=\"anchor\" aria-hidden=\"true\" href=\"#overview\"></a>Overview</h2>\n<p>A Puppet module to install and manage Cassandra, DataStax Agent &amp; OpsCenter</p>\n<h2><a id=\"user-content-setup\" class=\"anchor\" aria-hidden=\"true\" href=\"#setup\"></a>Setup</h2>\n<h3><a id=\"user-content-what-cassandra-affects\" class=\"anchor\" aria-hidden=\"true\" href=\"#what-cassandra-affects\"></a>What Cassandra affects</h3>\n<h4><a id=\"user-content-what-the-cassandra-class-affects\" class=\"anchor\" aria-hidden=\"true\" href=\"#what-the-cassandra-class-affects\"></a>What the Cassandra class affects</h4>\n<ul><li>Installs the Cassandra package (default <strong>cassandra22</strong> on Red Hat and\n<strong>cassandra</strong> on Debian).</li>\n<li>Configures settings in <code>${config_path}/cassandra.yaml</code>.</li>\n<li>On CentOS 7 if the <code>init</code> service provider is used, then cassandra\nis added as a system service.</li>\n<li>Optionally ensures that the Cassandra service is enabled and running.</li>\n<li>On Debian systems:\n<ul><li>Optionally replace <code>/etc/init.d/cassandra</code> with a workaround for\n<a href=\"https://issues.apache.org/jira/browse/CASSANDRA-9822\" rel=\"nofollow\">CASSANDRA-9822</a>.</li>\n</ul></li>\n</ul><h4><a id=\"user-content-what-the-cassandradatastax_agent-class-affects\" class=\"anchor\" aria-hidden=\"true\" href=\"#what-the-cassandradatastax_agent-class-affects\"></a>What the cassandra::datastax_agent class affects</h4>\n<ul><li>Optionally installs the DataStax agent.</li>\n<li>Optionally sets JAVA_HOME in <strong>/etc/default/datastax-agent</strong>.</li>\n</ul><h4><a id=\"user-content-what-the-cassandradatastax_repo-class-affects\" class=\"anchor\" aria-hidden=\"true\" href=\"#what-the-cassandradatastax_repo-class-affects\"></a>What the cassandra::datastax_repo class affects</h4>\n<ul><li>Optionally configures a Yum repository to install the Cassandra packages\nfrom (on Red Hat).</li>\n<li>Optionally configures an Apt repository to install the Cassandra packages\nfrom (on Debian).</li>\n</ul><h4><a id=\"user-content-what-the-cassandradse-class-affects\" class=\"anchor\" aria-hidden=\"true\" href=\"#what-the-cassandradse-class-affects\"></a>What the cassandra::dse class affects</h4>\n<ul><li>Optionally configures files in the <code>/etc/dse</code> directory if one is using\nDataStax Enterprise.</li>\n</ul><h4><a id=\"user-content-what-the-cassandrafirewall_ports-class-affects\" class=\"anchor\" aria-hidden=\"true\" href=\"#what-the-cassandrafirewall_ports-class-affects\"></a>What the cassandra::firewall_ports class affects</h4>\n<ul><li>Optionally configures the firewall for the Cassandra related network\nports.</li>\n</ul><h4><a id=\"user-content-what-the-cassandrajava-class-affects\" class=\"anchor\" aria-hidden=\"true\" href=\"#what-the-cassandrajava-class-affects\"></a>What the cassandra::java class affects</h4>\n<ul><li>Optionally installs a JRE/JDK package (e.g. java-1.7.0-openjdk) and the\nJava Native Access (JNA).</li>\n</ul><h4><a id=\"user-content-what-the-cassandraoptutils-class-affects\" class=\"anchor\" aria-hidden=\"true\" href=\"#what-the-cassandraoptutils-class-affects\"></a>What the cassandra::optutils class affects</h4>\n<ul><li>Optionally installs the Cassandra support tools (e.g. cassandra22-tools).</li>\n</ul><h3><a id=\"user-content-upgrading\" class=\"anchor\" aria-hidden=\"true\" href=\"#upgrading\"></a>Upgrading</h3>\n<p>We follow <a href=\"http://semver.org/\" rel=\"nofollow\">SemVer Versioning</a> and an update of the major\nrelease (i.e. from 1.<em>Y</em>.<em>Z</em> to 2.<em>Y</em>.<em>Z</em>) will indicate a significant change\nto the API which will most probably require a change to your manifest.</p>\n<h4><a id=\"user-content-changes-in-200\" class=\"anchor\" aria-hidden=\"true\" href=\"#changes-in-200\"></a>Changes in 2.0.0</h4>\n<p>This is a major change to the API and you will more than likely need to\nchange your manifest to accomodate these changes.</p>\n<p>The <code>service_ensure</code> attribute of the cassandra class now defaults to\n<em>undef</em>, users who do want to manage service status in Puppet can still set\nit to true.  If leaving the value at the default and setting\n<code>service_refresh</code> and <code>service_enable</code> to false will mean that the\nuser and not Puppet running will control the running state of\nCassandra.  This currently works OK on the Red Hat family, but\nhas issues on Debian due to\n<a href=\"https://issues.apache.org/jira/browse/CASSANDRA-2356\" rel=\"nofollow\">CASSANDRA-2356</a>\nduring an initial install or package upgrade.</p>\n<p>All the functionality relating to OpsCenter has been divested to the\n<a href=\"https://forge.puppet.com/locp/opscenter\" rel=\"nofollow\">locp/opscenter</a> module on\nPuppet Forge.</p>\n<p>It should also be noted that the module no longer creates directories for\nthe <code>data</code>, <code>commitlog</code>, <code>saved_caches</code> and for Cassandra 3 the <code>hints</code>\ndirectory.  These resources will now need to be defined in your\nmanifest/profile.</p>\n<p>For a list of features that have been deprecated in this release, please see\n<a href=\"https://github.com/voxpupuli/puppet-cassandra/wiki/Deprecations\">https://github.com/voxpupuli/puppet-cassandra/wiki/Deprecations</a></p>\n<p>For details on migrating from the version 1.X.X attributes to the <code>settings</code>\nhash, see\n(<a href=\"https://github.com/voxpupuli/puppet-cassandra/wiki/Suggested-Baseline-Settings\">https://github.com/voxpupuli/puppet-cassandra/wiki/Suggested-Baseline-Settings</a>)</p>\n<p>Please also see the notes for 2.0.0 in the\n<a href=\"https://github.com/voxpupuli/puppet-cassandra/blob/master/CHANGELOG.md\">CHANGELOG</a>.</p>\n<h4><a id=\"user-content-changes-in-1190\" class=\"anchor\" aria-hidden=\"true\" href=\"#changes-in-1190\"></a>Changes in 1.19.0</h4>\n<p>The hints_directory documentation will cause a change in the cassandra.yaml\nfile regardless of the value you set it to.  If you do not wish this to\nresult in a refesh of the Cassandra service, please set service_refresh to\nfalse.</p>\n<h4><a id=\"user-content-changes-in-192\" class=\"anchor\" aria-hidden=\"true\" href=\"#changes-in-192\"></a>Changes in 1.9.2</h4>\n<p>Now that Cassandra 3 is available from the DataStax repositories, there is\na problem (especially on Debian) with the operating system package manager\nattempting to install Cassandra 3.  This can be mitigated against using\nsomething similar to the code in this modules acceptance test.  Please note\nthat the default Cassandra package name has now been changed from 'dsc'.  See\nthe documentation for cassandra::package_name below for details.</p>\n<div class=\"highlight highlight-source-puppet\"><pre> if $::osfamily == 'RedHat' {\n   $version = '2.2.4-1'\n } else {\n   $version = '2.2.4'\n }\n class { 'cassandra':\n   package_ensure =&gt; $version,\n }</pre></div>\n<h4><a id=\"user-content-changes-in-180\" class=\"anchor\" aria-hidden=\"true\" href=\"#changes-in-180\"></a>Changes in 1.8.0</h4>\n<p>A somewhat embarrassing correction to the spelling of the\ncassandra::fail_on_non_suppoted_os to cassandra::fail_on_non_supported_os.</p>\n<h4><a id=\"user-content-issues-when-upgrading-to-140\" class=\"anchor\" aria-hidden=\"true\" href=\"#issues-when-upgrading-to-140\"></a>Issues when Upgrading to 1.4.0</h4>\n<p>Unfortunately both releases 1.3.7 and 1.4.0 have subsequently been found to\ncall a refresh service even when no changes had been made to the underlying\nconfiguration.  In release 1.8.0 (somewhat belatedly) the service_refresh\nflag has been introduced to mitigate against similar problems.</p>\n<h4><a id=\"user-content-issues-when-upgrading-to-137\" class=\"anchor\" aria-hidden=\"true\" href=\"#issues-when-upgrading-to-137\"></a>Issues When Upgrading to 1.3.7</h4>\n<ul><li>Please see the notes for 1.4.0.</li>\n</ul><h4><a id=\"user-content-changes-in-100\" class=\"anchor\" aria-hidden=\"true\" href=\"#changes-in-100\"></a>Changes in 1.0.0</h4>\n<ul><li>cassandra::cassandra_package_ensure has been renamed to\ncassandra::package_ensure.</li>\n<li>cassandra::cassandra_package_name has been renamed to\ncassandra::package_name.</li>\n</ul><h4><a id=\"user-content-changes-in-040\" class=\"anchor\" aria-hidden=\"true\" href=\"#changes-in-040\"></a>Changes in 0.4.0</h4>\n<p>There is now a cassandra::datastax_agent class, therefore:</p>\n<ul><li>cassandra::datastax_agent_package_ensure has now been replaced with\ncassandra::datastax_agent::package_ensure.</li>\n<li>cassandra::datastax_agent_service_enable has now been replaced with\ncassandra::datastax_agent::service_enable.</li>\n<li>cassandra::datastax_agent_service_ensure has now been replaced with\ncassandra::datastax_agent::service_ensure.</li>\n<li>cassandra::datastax_agent_package_name has now been replaced with\ncassandra::datastax_agent::package_name.</li>\n<li>cassandra::datastax_agent_service_name has now been replaced with\ncassandra::datastax_agent::service_name.</li>\n</ul><p>Likewise now there is a new class for handling the installation of Java:</p>\n<ul><li>cassandra::java_package_ensure has now been replaced with\ncassandra::java::ensure.</li>\n<li>cassandra::java_package_name has now been replaced with\ncassandra::java::package_name.</li>\n</ul><p>Also there is now a class for installing the optional utilities:</p>\n<ul><li>cassandra::cassandra_opt_package_ensure has now been replaced with\ncassandra::optutils:ensure.</li>\n<li>cassandra::cassandra_opt_package_name has now been replaced with\ncassandra::optutils:package_name.</li>\n</ul><h4><a id=\"user-content-changes-in-030\" class=\"anchor\" aria-hidden=\"true\" href=\"#changes-in-030\"></a>Changes in 0.3.0</h4>\n<ul><li>\n<p>cassandra_opt_package_ensure changed from 'present' to undef.</p>\n</li>\n<li>\n<p>The manage_service option has been replaced with service_enable and\nservice_ensure.</p>\n</li>\n</ul><h3><a id=\"user-content-beginning-with-cassandra\" class=\"anchor\" aria-hidden=\"true\" href=\"#beginning-with-cassandra\"></a>Beginning with Cassandra</h3>\n<p>Create a Cassandra 2.X cluster called MyCassandraCluster which uses the\nGossipingPropertyFileSnitch and password authentication.  In this very\nbasic example the node itself becomes a seed for the cluster and the\ncredentials will default to a user called cassandra with a password\ncalled of cassandra.</p>\n<div class=\"highlight highlight-source-puppet\"><pre># Cassandra pre-requisites\ninclude cassandra::datastax_repo\ninclude cassandra::java\nclass { 'cassandra':\n  settings =&gt; {\n    'authenticator'               =&gt; 'PasswordAuthenticator',\n    'cluster_name'                =&gt; 'MyCassandraCluster',\n    'commitlog_directory'         =&gt; '/var/lib/cassandra/commitlog',\n    'commitlog_sync'              =&gt; 'periodic',\n    'commitlog_sync_period_in_ms' =&gt; 10000,\n    'data_file_directories'       =&gt; ['/var/lib/cassandra/data'],\n    'endpoint_snitch'             =&gt; 'GossipingPropertyFileSnitch',\n    'listen_address'              =&gt; $::ipaddress,\n    'partitioner'                 =&gt; 'org.apache.cassandra.dht.Murmur3Partitioner',\n    'saved_caches_directory'      =&gt; '/var/lib/cassandra/saved_caches',\n    'seed_provider'               =&gt; [\n      {\n        'class_name' =&gt; 'org.apache.cassandra.locator.SimpleSeedProvider',\n        'parameters' =&gt; [\n          {\n            'seeds' =&gt; $::ipaddress,\n          },\n        ],\n      },\n    ],\n    'start_native_transport'      =&gt; true,\n  },\n  require  =&gt; Class['cassandra::datastax_repo', 'cassandra::java'],\n}</pre></div>\n<p>However, <strong>PLEASE</strong> note that this is the <strong>ABSOLUTE MINIMUM</strong> configuration\nto get Cassandra up and running but will probably give you a rather badly\nconfigured node.  Please see\n<a href=\"https://github.com/voxpupuli/puppet-cassandra/wiki/Suggested-Baseline-Settings\">Suggested Baseline Settings</a>\nfor details on making your configuration a lot more robust.</p>\n<p>For this code to run with version 3.X of Cassandra, the <code>hints_directory</code> will\nalso need to be specified:</p>\n<div class=\"highlight highlight-source-puppet\"><pre>...\nclass { 'cassandra':\n  settings =&gt; {\n    ...\n    'hints_directory'             =&gt; '/var/lib/cassandra/hints',\n    ...\n  },\n  require  =&gt; Class['cassandra::datastax_repo', 'cassandra::java'],\n}</pre></div>\n<h3><a id=\"user-content-hiera\" class=\"anchor\" aria-hidden=\"true\" href=\"#hiera\"></a>Hiera</h3>\n<p>In your top level node classification (usually <code>common.yaml</code>), add the\nsettings hash and all the tweaks you want all the clusters to use:</p>\n<div class=\"highlight highlight-source-yaml\"><pre>cassandra::baseline_settings:\n  authenticator: AllowAllAuthenticator\n  authorizer: AllowAllAuthorizer\n  auto_bootstrap: true\n  auto_snapshot: true\n  ...</pre></div>\n<p>Then, in the individual node classification add the parts which define\nthe cluster:</p>\n<div class=\"highlight highlight-source-yaml\"><pre>cassandra::settings:\n  cluster_name: developer playground cassandra cluster\ncassandra::dc: Onsite1\ncassandra::rack: RAC1\ncassandra::package_ensure: 3.0.5-1\ncassandra::package_name: cassandra30</pre></div>\n<h2><a id=\"user-content-usage\" class=\"anchor\" aria-hidden=\"true\" href=\"#usage\"></a>Usage</h2>\n<h3><a id=\"user-content-setup-a-keyspace-and-users\" class=\"anchor\" aria-hidden=\"true\" href=\"#setup-a-keyspace-and-users\"></a>Setup a keyspace and users</h3>\n<p>We assume that authentication has been enabled for the cassandra\ncluster and we are connecting with the default user name and password\n('cassandra/cassandra').</p>\n<p>In this example, we create a keyspace (mykeyspace) with a table called\n'users' and an index called 'users_lname_idx'.</p>\n<p>We also add three users (to Cassandra, not the mykeyspace.users\ntable) called spillman, akers and boone while ensuring that a user\ncalled lucan is absent.</p>\n<div class=\"highlight highlight-source-puppet\"><pre>class { 'cassandra':\n  ...\n}\nclass { 'cassandra::schema':\n  cqlsh_password =&gt; 'cassandra',\n  cqlsh_user     =&gt; 'cassandra',\n  cqlsh_host     =&gt; $::ipaddress,\n  indexes        =&gt; {\n    'users_lname_idx' =&gt; {\n      table    =&gt; 'users',\n      keys     =&gt; 'lname',\n      keyspace =&gt; 'mykeyspace',\n    },\n  },\n  keyspaces      =&gt; {\n    'mykeyspace' =&gt; {\n      durable_writes  =&gt; false,\n      replication_map =&gt; {\n        keyspace_class     =&gt; 'SimpleStrategy',\n        replication_factor =&gt; 1,\n      },\n    }\n  },\n  permissions    =&gt; {\n    'Grant select permissions to spillman to all keyspaces' =&gt; {\n      permission_name =&gt; 'SELECT',\n      user_name       =&gt; 'spillman',\n    },\n    'Grant modify to to keyspace mykeyspace to akers'       =&gt; {\n      keyspace_name   =&gt; 'mykeyspace',\n      permission_name =&gt; 'MODIFY',\n      user_name       =&gt; 'akers',\n    },\n    'Grant alter permissions to mykeyspace to boone'        =&gt; {\n      keyspace_name   =&gt; 'mykeyspace',\n      permission_name =&gt; 'ALTER',\n      user_name       =&gt; 'boone',\n    },\n    'Grant ALL permissions to mykeyspace.users to gbennet'  =&gt; {\n      keyspace_name   =&gt; 'mykeyspace',\n      permission_name =&gt; 'ALTER',\n      table_name      =&gt; 'users',\n      user_name       =&gt; 'gbennet',\n    },\n  },\n  tables         =&gt; {\n    'users' =&gt; {\n      columns  =&gt; {\n        user_id       =&gt; 'int',\n        fname         =&gt; 'text',\n        lname         =&gt; 'text',\n        'PRIMARY KEY' =&gt; '(user_id)',\n      },\n      keyspace =&gt; 'mykeyspace',\n    },\n  },\n  users          =&gt; {\n    'spillman' =&gt; {\n      password =&gt; 'Niner27',\n    },\n    'akers'    =&gt; {\n      password  =&gt; 'Niner2',\n      superuser =&gt; true,\n    },\n    'boone'    =&gt; {\n      password =&gt; 'Niner75',\n    },\n    'gbennet'  =&gt; {\n      'password' =&gt; 'foobar',\n    },\n    'lucan'    =&gt; {\n      'ensure' =&gt; absent\n    },\n  },\n}</pre></div>\n<h3><a id=\"user-content-create-a-cluster-in-a-single-data-center\" class=\"anchor\" aria-hidden=\"true\" href=\"#create-a-cluster-in-a-single-data-center\"></a>Create a Cluster in a Single Data Center</h3>\n<p>In the DataStax documentation <em>Initializing a multiple node cluster (single\ndata center)</em>\n<a href=\"http://docs.datastax.com/en/cassandra/2.2/cassandra/initialize/initSingleDS.html\" rel=\"nofollow\">http://docs.datastax.com/en/cassandra/2.2/cassandra/initialize/initSingleDS.html</a>\nthere is a basic example of a six node cluster with two seeds to be created in\na single data center spanning two racks.  The nodes in the cluster are:</p>\n<table><thead><tr><th><strong>Node Name</strong></th>\n<th><strong>IP Address</strong></th>\n</tr></thead><tbody><tr><td>node0 (seed 1)</td>\n<td>110.82.155.0</td>\n</tr><tr><td>node1</td>\n<td>110.82.155.1</td>\n</tr><tr><td>node2</td>\n<td>110.82.155.2</td>\n</tr><tr><td>node3 (seed 2)</td>\n<td>110.82.156.3</td>\n</tr><tr><td>node4</td>\n<td>110.82.156.4</td>\n</tr><tr><td>node5</td>\n<td>110.82.156.5</td>\n</tr></tbody></table><p>Each node is configured to use the GossipingPropertyFileSnitch and 256 virtual\nnodes (vnodes).  The name of the cluster is <em>MyCassandraCluster</em>.  Also,\nwhile building the initial cluster, we are setting the auto_bootstrap\nto false.</p>\n<p>In this initial example, we are going to expand the example by:</p>\n<ul><li>Ensuring that the software is installed via the DataStax Community\nrepository by including <code>cassandra::datastax_repo</code>.  This needs to be\nexecuted before the Cassandra package is installed.</li>\n<li>That a suitable Java Runtime environment (JRE) is installed with Java Native\nAccess (JNA) by including <code>cassandra::java</code>.  This need to be executed\nbefore the Cassandra service is started.</li>\n</ul><div class=\"highlight highlight-source-puppet\"><pre>node /^node\\d+$/ {\n  class { 'cassandra::datastax_repo':\n    before =&gt; Class['cassandra']\n  }\n  class { 'cassandra::java':\n    before =&gt; Class['cassandra']\n  }\n  class { 'cassandra':\n    settings       =&gt; {\n      'authenticator'               =&gt; 'AllowAllAuthenticator',\n      'auto_bootstrap'              =&gt; false,\n      'cluster_name'                =&gt; 'MyCassandraCluster',\n      'commitlog_directory'         =&gt; '/var/lib/cassandra/commitlog',\n      'commitlog_sync'              =&gt; 'periodic',\n      'commitlog_sync_period_in_ms' =&gt; 10000,\n      'data_file_directories'       =&gt; ['/var/lib/cassandra/data'],\n      'endpoint_snitch'             =&gt; 'GossipingPropertyFileSnitch',\n      'hints_directory'             =&gt; '/var/lib/cassandra/hints',\n      'listen_interface'            =&gt; 'eth1',\n      'num_tokens'                  =&gt; 256,\n      'partitioner'                 =&gt; 'org.apache.cassandra.dht.Murmur3Partitioner',\n      'saved_caches_directory'      =&gt; '/var/lib/cassandra/saved_caches',\n      'seed_provider'               =&gt; [\n        {\n          'class_name' =&gt; 'org.apache.cassandra.locator.SimpleSeedProvider',\n          'parameters' =&gt; [\n            {\n              'seeds' =&gt; '110.82.155.0,110.82.156.3',\n            },\n          ],\n        },\n      ],\n      'start_native_transport'      =&gt; true,\n    },\n  }\n}</pre></div>\n<p>The default value for the num_tokens is already 256, but it is\nincluded in the example for clarity.  Do not forget to either\nset auto_bootstrap to true or not set the attribute at all\nafter initializing the cluster.</p>\n<h3><a id=\"user-content-create-a-cluster-in-multiple-data-centers\" class=\"anchor\" aria-hidden=\"true\" href=\"#create-a-cluster-in-multiple-data-centers\"></a>Create a Cluster in Multiple Data Centers</h3>\n<p>To continue with the examples provided by DataStax, we look at the example\nfor a cluster across multiple data centers\n<a href=\"http://docs.datastax.com/en/cassandra/2.2/cassandra/initialize/initMultipleDS.html\" rel=\"nofollow\">http://docs.datastax.com/en/cassandra/2.2/cassandra/initialize/initMultipleDS.html</a>.</p>\n<table><thead><tr><th><strong>Node Name</strong></th>\n<th><strong>IP Address</strong></th>\n<th><strong>Data Center</strong></th>\n<th><strong>Rack</strong></th>\n</tr></thead><tbody><tr><td>node0 (seed 1)</td>\n<td>10.168.66.41</td>\n<td>DC1</td>\n<td>RAC1</td>\n</tr><tr><td>node1</td>\n<td>10.176.43.66</td>\n<td>DC1</td>\n<td>RAC1</td>\n</tr><tr><td>node2</td>\n<td>10.168.247.41</td>\n<td>DC1</td>\n<td>RAC1</td>\n</tr><tr><td>node3 (seed 2)</td>\n<td>10.176.170.59</td>\n<td>DC2</td>\n<td>RAC1</td>\n</tr><tr><td>node4</td>\n<td>10.169.61.170</td>\n<td>DC2</td>\n<td>RAC1</td>\n</tr><tr><td>node5</td>\n<td>10.169.30.138</td>\n<td>DC2</td>\n<td>RAC1</td>\n</tr></tbody></table><p>For the sake of simplicity, we will confine this example to the nodes:</p>\n<div class=\"highlight highlight-source-puppet\"><pre>node /^node[012]$/ {\n  class { 'cassandra':\n    dc             =&gt; 'DC1',\n    settings       =&gt; {\n      'authenticator'               =&gt; 'AllowAllAuthenticator',\n      'auto_bootstrap'              =&gt; false,\n      'cluster_name'                =&gt; 'MyCassandraCluster',\n      'commitlog_directory'         =&gt; '/var/lib/cassandra/commitlog',\n      'commitlog_sync'              =&gt; 'periodic',\n      'commitlog_sync_period_in_ms' =&gt; 10000,\n      'data_file_directories'       =&gt; ['/var/lib/cassandra/data'],\n      'endpoint_snitch'             =&gt; 'GossipingPropertyFileSnitch',\n      'hints_directory'             =&gt; '/var/lib/cassandra/hints',\n      'listen_interface'            =&gt; 'eth1',\n      'num_tokens'                  =&gt; 256,\n      'partitioner'                 =&gt; 'org.apache.cassandra.dht.Murmur3Partitioner',\n      'saved_caches_directory'      =&gt; '/var/lib/cassandra/saved_caches',\n      'seed_provider'               =&gt; [\n        {\n          'class_name' =&gt; 'org.apache.cassandra.locator.SimpleSeedProvider',\n          'parameters' =&gt; [\n            {\n              'seeds' =&gt; '110.82.155.0,110.82.156.3',\n            },\n          ],\n        },\n      ],\n      'start_native_transport'      =&gt; true,\n    },\n  }\n}\nnode /^node[345]$/ {\n  class { 'cassandra':\n    dc             =&gt; 'DC2',\n    settings       =&gt; {\n      'authenticator'               =&gt; 'AllowAllAuthenticator',\n      'auto_bootstrap'              =&gt; false,\n      'cluster_name'                =&gt; 'MyCassandraCluster',\n      'commitlog_directory'         =&gt; '/var/lib/cassandra/commitlog',\n      'commitlog_sync'              =&gt; 'periodic',\n      'commitlog_sync_period_in_ms' =&gt; 10000,\n      'data_file_directories'       =&gt; ['/var/lib/cassandra/data'],\n      'endpoint_snitch'             =&gt; 'GossipingPropertyFileSnitch',\n      'hints_directory'             =&gt; '/var/lib/cassandra/hints',\n      'listen_interface'            =&gt; 'eth1',\n      'num_tokens'                  =&gt; 256,\n      'partitioner'                 =&gt; 'org.apache.cassandra.dht.Murmur3Partitioner',\n      'saved_caches_directory'      =&gt; '/var/lib/cassandra/saved_caches',\n      'seed_provider'               =&gt; [\n        {\n          'class_name' =&gt; 'org.apache.cassandra.locator.SimpleSeedProvider',\n          'parameters' =&gt; [\n            {\n              'seeds' =&gt; '110.82.155.0,110.82.156.3',\n            },\n          ],\n        },\n      ],\n      'start_native_transport'      =&gt; true,\n    },\n  }\n}</pre></div>\n<p>We don't need to specify the rack name (with the rack attribute) as RAC1 is\nthe default value.  Again, do not forget to either set auto_bootstrap to\ntrue or not set the attribute at all after initializing the cluster.</p>\n<h3><a id=\"user-content-datastax-enterprise\" class=\"anchor\" aria-hidden=\"true\" href=\"#datastax-enterprise\"></a>DataStax Enterprise</h3>\n<p>After configuring the relevant repository, the following snippet works on\nCentOS 7 to install DSE Cassandra 4.7.0, set the HADOOP_LOG_DIR, set the\nDSE_HOME and configure DataStax Enterprise to use LDAP for authentication:</p>\n<div class=\"highlight highlight-source-puppet\"><pre>class { 'cassandra::datastax_repo':\n  descr   =&gt; 'DataStax Repo for DataStax Enterprise',\n  pkg_url =&gt; 'https://username:password@rpm.datastax.com/enterprise',\n  before  =&gt; Class['cassandra'],\n}\nclass { 'cassandra':\n  cluster_name    =&gt; 'MyCassandraCluster',\n  config_path     =&gt; '/etc/dse/cassandra',\n  package_ensure  =&gt; '4.7.0-1',\n  package_name    =&gt; 'dse-full',\n  service_name    =&gt; 'dse',\n  ...\n}\nclass { 'cassandra::dse':\n  file_lines =&gt; {\n    'Set HADOOP_LOG_DIR directory' =&gt; {\n      ensure =&gt; present,\n      path   =&gt; '/etc/dse/dse-env.sh',\n      line   =&gt; 'export HADOOP_LOG_DIR=/var/log/hadoop',\n      match  =&gt; '^# export HADOOP_LOG_DIR=&lt;log_dir&gt;',\n    },\n    'Set DSE_HOME'                 =&gt; {\n      ensure =&gt; present,\n      path   =&gt; '/etc/dse/dse-env.sh',\n      line   =&gt; 'export DSE_HOME=/usr/share/dse',\n      match  =&gt; '^#export DSE_HOME',\n    },\n  },\n  settings   =&gt; {\n    ldap_options =&gt; {\n      server_host                =&gt; localhost,\n      server_port                =&gt; 389,\n      search_dn                  =&gt; 'cn=Admin',\n      search_password            =&gt; secret,\n      use_ssl                    =&gt; false,\n      use_tls                    =&gt; false,\n      truststore_type            =&gt; jks,\n      user_search_base           =&gt; 'ou=users,dc=example,dc=com',\n      user_search_filter         =&gt; '(uid={0})',\n      credentials_validity_in_ms =&gt; 0,\n      connection_pool            =&gt; {\n        max_active =&gt; 8,\n        max_idle   =&gt; 8,\n      }\n    }\n  }\n}</pre></div>\n<h3><a id=\"user-content-apache-cassandra\" class=\"anchor\" aria-hidden=\"true\" href=\"#apache-cassandra\"></a>Apache Cassandra</h3>\n<p>DataStax announced in late October 2016 that it was no longer supporting\nthe community edition of Cassandra or DSC as it was known (see\n<em>[Take a bow Planet\nCassandra]</em>(<a href=\"http://www.datastax.com/2016/10/take-a-bow-planet-cassandra\" rel=\"nofollow\">http://www.datastax.com/2016/10/take-a-bow-planet-cassandra</a>)\nfor details).  However, the following snippet of code running on Ubuntu\n14.04 worked fine without having to change any of the <code>::cassandra</code> class\nsettings:</p>\n<div class=\"highlight highlight-source-puppet\"><pre>require cassandra::java\ninclude cassandra::optutils\nclass { 'cassandra::apache_repo':\n  release =&gt; '310x',\n  before  =&gt; Class['cassandra', 'cassandra::optutils'],\n}\nclass { 'cassandra':\n  ...\n}</pre></div>\n<h2><a id=\"user-content-reference\" class=\"anchor\" aria-hidden=\"true\" href=\"#reference\"></a>Reference</h2>\n<p>The reference documentation is generated using the\n<a href=\"https://github.com/puppetlabs/puppet-strings\">puppet-strings</a> tool.  To see\nall of it, please go to\n<a href=\"http://voxpupuli.github.io/puppet-cassandra/_index.html\" rel=\"nofollow\">http://voxpupuli.github.io/puppet-cassandra</a>.</p>\n<h2><a id=\"user-content-limitations\" class=\"anchor\" aria-hidden=\"true\" href=\"#limitations\"></a>Limitations</h2>\n<ul><li>When using a Ruby version before 1.9.0, the contents of the Cassandra\nconfiguration file may change order of elements due to a problem with\nto_yaml in earlier versions of Ruby.</li>\n<li>When creating key spaces, indexes, cql_types and users the settings will only\nbe used to create a new resource if it does not currently exist.  If a change\nis made to the Puppet manifest but the resource already exits, this change\nwill not be reflected.</li>\n<li>At the moment the <code>cassandra::system::transparent_hugepage</code> does not\npersist between reboots.</li>\n<li>Acceptance for Debian 7 are confined to Cassandra 2.1 and 2.2.  There is\na conflict between the GLIBC on Debian 7 and the newer releases of Cassandra\n3.X.</li>\n</ul><h2><a id=\"user-content-development\" class=\"anchor\" aria-hidden=\"true\" href=\"#development\"></a>Development</h2>\n<p>Contributions will be gratefully accepted.  Please go to the project page,\nfork the project, make your changes locally and then raise a pull request.\nDetails on how to do this are available at\n<a href=\"https://guides.github.com/activities/contributing-to-open-source\">https://guides.github.com/activities/contributing-to-open-source</a>.</p>\n<p>Please also see the\n<a href=\"https://github.com/voxpupuli/puppet-cassandra/blob/master/CONTRIBUTING.md\">CONTRIBUTING.md</a>\npage for project specific requirements.</p>\n<h3><a id=\"user-content-additional-contributers\" class=\"anchor\" aria-hidden=\"true\" href=\"#additional-contributers\"></a>Additional Contributers</h3>\n<p>For a list of contributers see\n<a href=\"https://github.com/voxpupuli/puppet-cassandra/blob/master/CONTRIBUTING.md\">CONTRIBUTING.md</a>\nand <a href=\"https://github.com/voxpupuli/puppet-cassandra/graphs/contributors\">https://github.com/voxpupuli/puppet-cassandra/graphs/contributors</a></p>\n</article>"}}]}},"pageContext":{"alternative_id":12452}}