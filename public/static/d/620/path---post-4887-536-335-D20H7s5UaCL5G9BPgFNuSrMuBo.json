{"data":{"allAnantCassandralinks":{"edges":[{"node":{"title":"Cassandra StatD Agent","alternative_id":4887,"content":"<p>Thanks to UnderSiege for getting this project off the ground.</p><h2><a href=\"https://github.com/lookout/cassandra-statsd-agent#requirements\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-requirements\"></a>REQUIREMENTS</h2><ul><li>Maven</li>\n<li>Java 7</li>\n</ul><h2><a href=\"https://github.com/lookout/cassandra-statsd-agent#build\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-build\"></a>BUILD</h2><p>Check which metrics library cassandra is using by looking in\ncassandra/lib/metrics-core*, verify that pom.xml points to the\nsame exact version. For example, if you have metrics-core-2.2.0.jar,\nmake sure pom.xml has 2.2.0.</p><p><code>mvn package</code></p><p>Alternatively, grab the binary from bintray:</p><p><code>curl -L http://dl.bintray.com/lookout/systems/com/github/lookout/metrics/agent/1.2/agent-1.2.jar -o agent-1.2.jar</code></p><h2><a href=\"https://github.com/lookout/cassandra-statsd-agent#install\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-install\"></a>INSTALL</h2><p>Copy the statsd library from the .m2 folder to cassandra/lib.\nAdd the following to your cassandra startup script:</p><p>Copy the agent-1.2.jar to a new directory cassandra/plugins</p><p>Change cassandra startup to add this agent. This can be done in\na stock install by adding the following to /etc/default/cassandra:</p><p><code>export JVM_OPTS=\"-javaagent:/usr/share/cassandra/plugins/agent-1.2.jar=localhost\"</code></p><p>Note the '=localhost' at the end. This supports the following syntaxes:\n<code>hostname:port@interval</code>\nFor example:\n<code>your.statsd.host.com:9999@60</code>\nThe default port is 8125 and the default interval is 10 (seconds); these\ncan be omitted. IPV6 is also supported with the following syntax:\n<code>[2001:db8::1]:8888@300</code>\nwhich means connect to 2001:db8::1 on port 8888 every 300 seconds.</p><h2><a href=\"https://github.com/lookout/cassandra-statsd-agent#reporting\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-reporting\"></a>REPORTING</h2><p>A log message will be added to the system.log at startup to\nconfirm that everything is running, it looks like this:</p><p><code>INFO [metrics-statsd-thread-1] 2014-12-19 19:05:37,120 StatsdReporter.java:65 - Statsd reporting to host localhost port 8125 every 10 seconds</code></p><h2><a href=\"https://github.com/lookout/cassandra-statsd-agent#what-gets-reported\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-what-gets-reported\"></a>WHAT GETS REPORTED</h2><p>Lots of stuff:</p><ul><li>Gossip statistics:\ngossip.score., which help decide who is closer/faster for queries\ngossip.severity, which indicates how busy this node is self-reporting to others</li>\n<li>Per table statistics:\ncfstats...ReadCount\ncfstats...WriteCount\ncfstats...RecentReadLatencyMicros\ncfstats...RecentWriteLatencyMicros\ncfstats...TombstonesPerSlice\ncfstats...estimatedKeys\nThe last one is great for monitoring general trends, but of course don't\nrely on that number to be very accurate.</li>\n<li>PHI reporter\nAlso supported is the currently-experimental PHI reporter, in PHI.,\ncoming to a Cassandra cluster near you soon.</li>\n<li>JVM GC metrics</li>\n<li>Anything else registered with yammer-metrics</li>\n</ul><h2><a href=\"https://github.com/lookout/cassandra-statsd-agent#debugging\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-debugging\"></a>DEBUGGING</h2><p>Not working? There's a lot of tracing and debugging available. Change the\nlog4j-server.properties and add something like this to get extremely detailed\ntraces of what it's doing in the server.log.</p><p><code>log4j.logger.com.github.lookout.metrics.agent.generators=TRACE</code></p><h2><a href=\"https://github.com/lookout/cassandra-statsd-agent#todo\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-todo\"></a>TODO</h2><p>Errors that happen during startup are not reported as well as they should\nbe, mostly because the logging system is not active during startup. The log\nmessage is only generated when the actual metrics collector has run for the\nfirst time.</p>"}}]}},"pageContext":{"alternative_id":4887}}