{"data":{"allAnantCassandralinks":{"edges":[{"node":{"title":"GoogleCloudPlatform/gke-stateful-applications-demo","alternative_id":12922,"content":"<article class=\"markdown-body entry-content\" itemprop=\"text\">\n<h2><a id=\"user-content-table-of-contents\" class=\"anchor\" aria-hidden=\"true\" href=\"#table-of-contents\"></a>Table of Contents</h2>\n<ul><li><a href=\"#google-kubernetes-engine-stateful-application-demo\">Google Kubernetes Engine Stateful Application Demo</a></li>\n<li><a href=\"#introduction\">Introduction</a></li>\n<li><a href=\"#architecture\">Architecture</a>\n<ul><li><a href=\"#architecture-diagram\">Architecture Diagram</a></li>\n<li><a href=\"#kubernetes-manifests-and-controllers\">Kubernetes Manifests and Controllers</a>\n<ul><li><a href=\"#statefulsets\">StatefulSets</a></li>\n<li><a href=\"#persistent-storage-with-persistent-volumes\">Persistent Storage with Persistent Volumes</a></li>\n<li><a href=\"#pod-disruptions-budgets\">Pod Disruptions Budgets</a></li>\n<li><a href=\"#pod-scheduling\">Pod Scheduling</a></li>\n<li><a href=\"#dns-and-headless-services\">DNS and Headless Services</a></li>\n</ul></li>\n<li><a href=\"#cassandra-container\">Cassandra Container</a></li>\n</ul></li>\n<li><a href=\"#prerequisites\">Prerequisites</a>\n<ul><li><a href=\"#run-demo-in-a-google-cloud-shell\">Run Demo in a Google Cloud Shell</a></li>\n<li><a href=\"#supported-operating-systems\">Supported Operating Systems</a></li>\n<li><a href=\"#tools\">Tools</a></li>\n<li><a href=\"#versions\">Versions</a></li>\n</ul></li>\n<li><a href=\"#deployment-steps\">Deployment Steps</a></li>\n<li><a href=\"#validation\">Validation</a>\n<ul><li><a href=\"#using-cassandara\">Using Cassandara</a></li>\n<li><a href=\"#launch-a-cassandra-container\">Launch a Cassandra container</a></li>\n<li><a href=\"#connect-to-the-ring-with-cqlsh\">Connect to the ring with cqlsh</a>\n<ul><li><a href=\"#cqlsh-command\">cqlsh command</a></li>\n</ul></li>\n<li><a href=\"#create-a-keyspace\">Create a keyspace</a></li>\n<li><a href=\"#describe-the-keyspace\">Describe the keyspace</a></li>\n<li><a href=\"#use-the-new-keyspace\">Use the new keyspace</a></li>\n<li><a href=\"#create-a-table\">Create a table</a></li>\n<li><a href=\"#see-the-newly-created-table\">See the newly created table</a></li>\n<li><a href=\"#insert-data-into-the-table\">Insert data into the table</a></li>\n<li><a href=\"#select-the-data-from-the-table\">Select the data from the table</a></li>\n<li><a href=\"#exit\">Exit</a>\n<ul><li><a href=\"#delete-the-deployment\">Delete the deployment</a></li>\n</ul></li>\n</ul></li>\n<li><a href=\"#tear-down\">Tear Down</a></li>\n<li><a href=\"#troubleshooting\">Troubleshooting</a></li>\n<li><a href=\"#relevant-materials\">Relevant Materials</a></li>\n</ul><h2><a id=\"user-content-introduction\" class=\"anchor\" aria-hidden=\"true\" href=\"#introduction\"></a>Introduction</h2>\n<p>This proof of concept deploys a\n<a href=\"https://cloud.google.com/kubernetes-engine/\" rel=\"nofollow\">Kubernetes Engine</a>\nCluster and then installs an <a href=\"http://cassandra.apache.org/\" rel=\"nofollow\">Apache Cassandra</a>\ndatabase running on that cluster.</p>\n<p>Various scripts are contained within this project that provide push button\ncreation, validation, and deletion of the Cassandra(C*) database and Kubernetes\nEngine cluster.</p>\n<p>Apache Cassandra was chosen for various reasons.  These reasons include that\nout of the box Cassandra functions well as a cloud native database.  Moreover,\nthis POC continues the work started with the Kubernetes example, and the blog\npost: <a href=\"https://kubernetes.io/blog/2016/07/thousand-instances-of-cassandra-using-kubernetes-pet-set\" rel=\"nofollow\">Thousand Instances of Cassandra using Kubernetes Pet Set</a>.</p>\n<p>When running a database using Kubernetes Engine, as an operator you need to be experienced with Kubernetes Engine\nand the datasource that you are running.  If you are able to use a hosted\nsolution then it is recommended that you use the hosted solution. On the other\nhand, if you are not able to run a datasource in a hosted solution then hosting\nit is Kubernetes Engine is doable.  The challenge is not Kubernetes or Kubernetes Engine, but the challenge\nis migrating and operating a database in a container based system that can do\nthings like moving pods/containers between nodes.</p>\n<h2><a id=\"user-content-architecture\" class=\"anchor\" aria-hidden=\"true\" href=\"#architecture\"></a>Architecture</h2>\n<p>The intricacy of the running stateful datastores via Kubernetes Engine or K8s lies with\nthe various Kubernetes manifests and pod configurations used. A container that\nhas been customized to run as a pod is used as well. This demo includes multiple\nconfigured manifests and a specialized container for Cassandra.</p>\n<p>Many people, including Kelsey Hightower, have talked about how running stateful\ndatestores inside of K8s is not trivial, and frankly quite complicated.  If you\ncan run a database on a managed service, do it.  Let someone else wake up at 2\nam to fix your database.</p>\n<p>There are two possibilities when you run a stateful datastore on K8s.</p>\n<ol><li>You are very experienced K8s user and know exactly what is around the corner.</li>\n<li>You have no idea what is around the corner, and you are going to learn very\nfast.</li>\n</ol><h3><a id=\"user-content-architecture-diagram\" class=\"anchor\" aria-hidden=\"true\" href=\"#architecture-diagram\"></a>Architecture Diagram</h3>\n<p>The following diagram represents a Cassandra cluster deployed on Kubernetes Engine.</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/GoogleCloudPlatform/gke-stateful-applications-demo/blob/master/images/gke-cassandra.png\"><img src=\"https://github.com/GoogleCloudPlatform/gke-stateful-applications-demo/raw/master/images/gke-cassandra.png\" alt=\"Cassandra Running on Kubernetes Engine\" /></a></p>\n<h3><a id=\"user-content-kubernetes-manifests-and-controllers\" class=\"anchor\" aria-hidden=\"true\" href=\"#kubernetes-manifests-and-controllers\"></a>Kubernetes Manifests and Controllers</h3>\n<p>Various manifests and controllers are utilized to install Cassandra.  The\nfollowing sections outline the different types used.</p>\n<h4><a id=\"user-content-statefulsets\" class=\"anchor\" aria-hidden=\"true\" href=\"#statefulsets\"></a>StatefulSets</h4>\n<p>StatefulSets is the controller type that is used to install a Cassandra Ring on\nKubernetes Engine.  This controller manages the installation and scaling of a set of Pods and\nprovides various features:</p>\n<ol><li>Stable, unique network identifiers.</li>\n<li>Stable, persistent storage.</li>\n<li>Ordered, graceful deployment and scaling.</li>\n<li>Ordered, graceful deletion and termination.</li>\n<li>Ordered, automated rolling updates.</li>\n<li>Automated creation of storage volumes.</li>\n<li>Stable guaranteed storage.</li>\n</ol><p>Like a Deployment, a StatefulSet manages Pods that are based on an identical\ncontainer spec. Unlike a Deployment, a StatefulSet maintains a sticky identity\nfor each of their Pods. These pods are created from the same spec, but are not\ninterchangeable: each has a persistent identifier that it maintains across any\nrescheduling.</p>\n<p>Cassandra utilizes all of these features in order to run on Kubernetes Engine.</p>\n<p>Find more information <a href=\"https://kubernetes.io/docs/tutorials/stateful-application/basic-stateful-set/\" rel=\"nofollow\">here</a>.</p>\n<h4><a id=\"user-content-persistent-storage-with-persistent-volumes\" class=\"anchor\" aria-hidden=\"true\" href=\"#persistent-storage-with-persistent-volumes\"></a>Persistent Storage with Persistent Volumes</h4>\n<p>With a stateful datasource storage is required.</p>\n<p>A PersistentVolume (PV) is a piece of storage in the cluster that has been\nprovisioned by an administrator, or automatically by a Stateful Set. It is a\nresource in the cluster just like a node is a cluster resource. PVs are volume\nplugins like Volumes, but have a lifecycle independent of any individual pod\nthat uses the PV.</p>\n<p>A PersistentVolumeClaim (PVC) is a request for storage by a user. It is similar\nto a pod. Pods consume node resources and PVCs consume PV resources. Pods can\nrequest specific levels of resources (CPU and Memory). Claims can request\nspecific size and access modes (e.g., can be mounted once read/write or many\ntimes read-only).</p>\n<p>Find more information <a href=\"https://kubernetes.io/docs/concepts/storage/persistent-volumes/\" rel=\"nofollow\">here</a>.</p>\n<h4><a id=\"user-content-pod-disruptions-budgets\" class=\"anchor\" aria-hidden=\"true\" href=\"#pod-disruptions-budgets\"></a>Pod Disruptions Budgets</h4>\n<p>An Application Owner can create a PodDisruptionBudget object (PDB) for each\napplication. A PDB limits the number pods of a replicated application that are\ndown simultaneously from voluntary disruptions. For example, with Cassandra\nwe need to ensure that the number of replicas running is never brought below\nthe number needed for a quorum.</p>\n<p>Find more information visit <a href=\"https://kubernetes.io/docs/concepts/workloads/pods/disruptions/\" rel=\"nofollow\">here</a>.</p>\n<h4><a id=\"user-content-pod-scheduling\" class=\"anchor\" aria-hidden=\"true\" href=\"#pod-scheduling\"></a>Pod Scheduling</h4>\n<p>This proof of concept utilizes advanced scheduling for pod placement.  Both\nscheduling anti-affinity rules and taints are used to instruct the K8s scheduler\nwhere to launch C* pods.</p>\n<p>Anti-Affinity rules instruct the scheduler to use preferred or required pod\nplacement. Preferred rules provide a weight value that impacts the scheduling\nalgorithm to not schedule C* pods on the same node.  While required rules force\nthe scheduler to not schedule C* pods on the same node.  Not having multiple\nCassandra pods on the same node increases fault tolerance, as when you lose a\nnode you only lose one pod.  But then you need to have an excess of nodes because\na pod will not reschedule.  Preferred does not provide the same level of high\navailability, but will allow pods to reschedule on existing nodes if headroom\nexists.</p>\n<p>Find more information visit <a href=\"https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#inter-pod-affinity-and-anti-affinity-beta-feature\" rel=\"nofollow\">here</a>.</p>\n<p>Taints prevent pods to be scheduled on a node, unless the pod's manifest\ncontains the required toleration. The typical use case for this is to target\na specific node pool for say Cassandra pods.  For instance, often larger machine\ntypes are required for C*, and adding taints to those nodes ensure that\nCassandra pods will only be scheduled on the nodes.</p>\n<p>Find more information visit <a href=\"https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/\" rel=\"nofollow\">here</a>.</p>\n<h4><a id=\"user-content-dns-and-headless-services\" class=\"anchor\" aria-hidden=\"true\" href=\"#dns-and-headless-services\"></a>DNS and Headless Services</h4>\n<p>The Cassandra ring that is installed as part of this demo is named \"cassandra\".\nThe name of the service \"cassandra\" creates the DNS name, and the tld is\n\"default.svc.cluster.local\", where \"default\" is the name of the namespace.  With\nan application you would connect to at least three of the nodes to provide an HA\nconnection with a client.  The name of the nodes, for example would be:</p>\n<pre>cassandra-0.cassandra.default.svc.cluster.local\ncassandra-1.cassandra.default.svc.cluster.local\ncassandra-1.cassandra.default.svc.cluster.local\n</pre>\n<p>For more information visit <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/#headless-services\" rel=\"nofollow\">here</a>.</p>\n<h3><a id=\"user-content-cassandra-container\" class=\"anchor\" aria-hidden=\"true\" href=\"#cassandra-container\"></a>Cassandra Container</h3>\n<p>Within this demo we have included a container that is specifically built for\nrunning on Kubernetes.  Features:</p>\n<ol><li>OSS maintained base container that is used by K8s OSS project</li>\n<li>Cassandra is installed from a tarball</li>\n<li>Container size has been reduced</li>\n<li>A readiness and liveness probes are built-in</li>\n<li>Prometheus is installed, but the port is not exposed in the manifest by\ndefault</li>\n<li>dumb-init is used to handle signal processing</li>\n<li>A logging encoder is provided for JSON logging</li>\n<li>Datacenter configuration</li>\n<li>JMX configuration</li>\n<li>Multiple ENV variables are exposed for manifest based configuration</li>\n</ol><p>For more information about the ENV variables that have been exposed see\n<a href=\"https://github.com/GoogleCloudPlatform/gke-stateful-applications-demo/blob/master/contain/README.md\">container/README.md</a>,\n<a href=\"https://github.com/GoogleCloudPlatform/gke-stateful-applications-demo/blob/master/container/files/run.sh\">container/files/run.sh</a> and also the\n<a href=\"https://github.com/GoogleCloudPlatform/gke-stateful-applications-demo/blob/master/manifests/cassandra-statefulset.yaml\">manifest</a>.</p>\n<p>This container is hosted by Google Professional Services.</p>\n<h2><a id=\"user-content-prerequisites\" class=\"anchor\" aria-hidden=\"true\" href=\"#prerequisites\"></a>Prerequisites</h2>\n<p>A Google Cloud account and project is required for this demo. The project must\nhave the proper quota to run a Kubernetes Engine cluster with at least\n3 n1-standard-4 and 3 n1-standard-1 nodes.  Additionally, the project must have\nat least 30 Compute Engine API CPUs and 12 Compute Engine API In-use IP Addresses.</p>\n<p>Access to an existing Google Cloud project with the Kubernetes Engine service enabled\nIf you do not have a Google Cloud account please signup for a free trial\n<a href=\"https://cloud.google.com\" rel=\"nofollow\">here</a>.</p>\n<p>How to check your account's quota is documented here: <a href=\"https://cloud.google.com/compute/quotas\" rel=\"nofollow\">quotas</a>.</p>\n<h3><a id=\"user-content-run-demo-in-a-google-cloud-shell\" class=\"anchor\" aria-hidden=\"true\" href=\"#run-demo-in-a-google-cloud-shell\"></a>Run Demo in a Google Cloud Shell</h3>\n<p>Click the button below to run the demo in a <a href=\"https://cloud.google.com/shell/docs/\" rel=\"nofollow\">Google Cloud Shell</a>.</p>\n<p><a href=\"https://console.cloud.google.com/cloudshell/open?git_repo=https%3A%2F%2Fgithub.com%2FGoogleCloudPlatform%2Fgke-stateful-applications-demo&amp;page=editor&amp;tutorial=README.md\" rel=\"nofollow\"><img src=\"https://camo.githubusercontent.com/acf32864fdae185325f992b48fb2132badef1e9a/687474703a2f2f677374617469632e636f6d2f636c6f75647373682f696d616765732f6f70656e2d62746e2e737667\" alt=\"Open in Cloud Shell\" data-canonical-src=\"http://gstatic.com/cloudssh/images/open-btn.svg\" /></a></p>\n<p>All the tools for the demo are installed. When using Cloud Shell execute the following\ncommand in order to setup gcloud cli. When executing this command please setup your region\nand zone.</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>gcloud init</pre></div>\n<h3><a id=\"user-content-supported-operating-systems\" class=\"anchor\" aria-hidden=\"true\" href=\"#supported-operating-systems\"></a>Supported Operating Systems</h3>\n<p>This project will run on macOS, or in a <a href=\"https://cloud.google.com/shell/docs/\" rel=\"nofollow\">Google Cloud Shell</a>.</p>\n<h3><a id=\"user-content-tools\" class=\"anchor\" aria-hidden=\"true\" href=\"#tools\"></a>Tools</h3>\n<p>When not using Cloud Shell, the following tools are required.</p>\n<ol><li><a href=\"https://cloud.google.com/sdk/docs/downloads-versioned-archives\" rel=\"nofollow\">Google Cloud SDK version &gt;= 204.0.0</a></li>\n<li><a href=\"https://cloud.google.com/sdk/gcloud/\" rel=\"nofollow\">gcloud cli</a></li>\n<li><a href=\"https://kubernetes.io/docs/tasks/tools/install-kubectl/\" rel=\"nofollow\">kubectl matching the latest GKE version</a></li>\n<li>docker (used to build container, you can use hosted container)</li>\n</ol><p>More recent versions of all the tools may function, please feel free to file an\nissue if you encounter problems with newer versions.</p>\n<h4><a id=\"user-content-install-cloud-sdk\" class=\"anchor\" aria-hidden=\"true\" href=\"#install-cloud-sdk\"></a>Install Cloud SDK</h4>\n<p>The Google Cloud SDK is used to interact with your GCP resources.\n<a href=\"https://cloud.google.com/sdk/downloads\" rel=\"nofollow\">Installation instructions</a> for multiple platforms are available online.</p>\n<h4><a id=\"user-content-install-kubectl-cli\" class=\"anchor\" aria-hidden=\"true\" href=\"#install-kubectl-cli\"></a>Install kubectl CLI</h4>\n<p>The kubectl CLI is used to interteract with both Kubernetes Engine and kubernetes in general.\n<a href=\"https://cloud.google.com/kubernetes-engine/docs/quickstart\" rel=\"nofollow\">Installation instructions</a>\nfor multiple platforms are available online.</p>\n<h3><a id=\"user-content-configure-authentication\" class=\"anchor\" aria-hidden=\"true\" href=\"#configure-authentication\"></a>Configure Authentication</h3>\n<p>The script will execute against your GCP environment and it will use your personal account to build out these resources.  To setup the default account the script will use, run the following command to select the appropriate account:</p>\n<p><code>gcloud auth login</code></p>\n<h2><a id=\"user-content-deployment-steps\" class=\"anchor\" aria-hidden=\"true\" href=\"#deployment-steps\"></a>Deployment Steps</h2>\n<p>To deploy the demo execute the following commands.</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>git clone https://github.com/GoogleCloudPlatform/gke-stateful-applications-demo\ncd gke-stateful-applications-demo\n./create.sh -c my-cluster-1</pre></div>\n<p>Replace the text 'my-cluster-1' the name of the cluster that you would like to\ncreate.</p>\n<p>The create script will output the following message when complete.</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>NAME                 MACHINE_TYPE   DISK_SIZE_GB  NODE_VERSION\nnodepool-cassdemo-2  n1-standard-1  100           1.10.2-gke.3</pre></div>\n<p>The script will:</p>\n<ol><li>create a new Kubernetes Engine cluster in your default ZONE, VPC and network.</li>\n<li>install multiple Kubernetes manifests that can be found in the\n<a href=\"https://github.com/GoogleCloudPlatform/gke-stateful-applications-demo/blob/master/manifests\">manifests</a> directory.</li>\n</ol><p>Because we are creating a cluster of 6 nodes, the cluster may go into a\n'RECONCILING' status as the control plane's instance size may be increased.</p>\n<p>Use the following command to view the current status of the cluster.</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>gcloud container clusters list</pre></div>\n<p>An example of the output while the cluster is reconciling.</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>NAME          LOCATION       MASTER_VERSION  MASTER_IP      MACHINE_TYPE   NODE_VERSION  NUM_NODES  STATUS\nmy-cluster-1  us-central1-a  1.10.2-gke.3    35.184.70.165  n1-standard-4  1.10.2-gke.3  6          RECONCILING</pre></div>\n<p>The status will change to RUNNING once the masters have been updated.</p>\n<h2><a id=\"user-content-validation\" class=\"anchor\" aria-hidden=\"true\" href=\"#validation\"></a>Validation</h2>\n<p>The following script will validate that the demo is deployed correctly:</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>./validate.sh -c my-cluster-1</pre></div>\n<p>Replace the text 'my-cluster-1' the name of the cluster that you would like to\nvalidate.</p>\n<p>The validation script uses <code>kubectl rollout status</code> to test if the rollout is\ncomplete. If the cluster is in 'RECONCILING' state this script will fail as\nwell.</p>\n<p>If the script fails it will output:</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>Validation Failed: Statefulset has not been deployed</pre></div>\n<p>If the script passes if will output:</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>Validation Passed: the Statefulset has been deployed</pre></div>\n<h3><a id=\"user-content-using-cassandara\" class=\"anchor\" aria-hidden=\"true\" href=\"#using-cassandara\"></a>Using Cassandara</h3>\n<p>These commands exercise the Cassandra cluster.</p>\n<h3><a id=\"user-content-launch-a-cassandra-container\" class=\"anchor\" aria-hidden=\"true\" href=\"#launch-a-cassandra-container\"></a>Launch a Cassandra container</h3>\n<p>These <code>kubectl</code> commands launch a K8s deployment, wait for the deployment,\nand exec into the shell.</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>kubectl run cass-dev --image gcr.io/pso-examples/cassandra:3.11.3-cqlsh-v22 --command -- /bin/bash -c \"tail -f /dev/null\"\nkubectl rollout status deployment cass-dev\nkubectl exec $(kubectl get po --no-headers | grep cass-dev | awk '{print $1}') -it -- /bin/bash</pre></div>\n<p>This will launch a bash prompt for the next steps.</p>\n<h3><a id=\"user-content-connect-to-the-ring-with-cqlsh\" class=\"anchor\" aria-hidden=\"true\" href=\"#connect-to-the-ring-with-cqlsh\"></a>Connect to the ring with cqlsh</h3>\n<h4><a id=\"user-content-cqlsh-command\" class=\"anchor\" aria-hidden=\"true\" href=\"#cqlsh-command\"></a>cqlsh command</h4>\n<div class=\"highlight highlight-text-shell-session\"><pre>/usr/local/apache-cassandra/bin/cqlsh cassandra-0.cassandra.default.svc.cluster.local</pre></div>\n<p>You will now be using the interactive <code>cqlsh</code> shell.</p>\n<p>The output of the command:</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>Connected to K8Demo at cassandra-0.cassandra.default.svc.cluster.local:9042.\n[cqlsh 5.0.1 | Cassandra 3.11.3 | CQL spec 3.4.4 | Native protocol v4]\nUse HELP for help.\ncqlsh&gt;</pre></div>\n<h3><a id=\"user-content-create-a-keyspace\" class=\"anchor\" aria-hidden=\"true\" href=\"#create-a-keyspace\"></a>Create a keyspace</h3>\n<div class=\"highlight highlight-text-shell-session\"><pre>CREATE KEYSPACE greek_monsters WITH REPLICATION = { 'class' : 'SimpleStrategy' , 'replication_factor' : 3 };</pre></div>\n<p>The user prompt is shown if the command is successful.</p>\n<h3><a id=\"user-content-describe-the-keyspace\" class=\"anchor\" aria-hidden=\"true\" href=\"#describe-the-keyspace\"></a>Describe the keyspace</h3>\n<div class=\"highlight highlight-text-shell-session\"><pre>DESC greek_monsters;</pre></div>\n<p>Example output:</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>CREATE KEYSPACE greek_monsters WITH replication = {'class': 'SimpleStrategy', 'replication_factor': '3'}  AND durable_writes = true;\ncqlsh&gt;</pre></div>\n<h3><a id=\"user-content-use-the-new-keyspace\" class=\"anchor\" aria-hidden=\"true\" href=\"#use-the-new-keyspace\"></a>Use the new keyspace</h3>\n<div class=\"highlight highlight-text-shell-session\"><pre>USE greek_monsters;</pre></div>\n<p>The prompt will now include the keyspace that is selected.</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>cqlsh:greek_monsters&gt;</pre></div>\n<h3><a id=\"user-content-create-a-table\" class=\"anchor\" aria-hidden=\"true\" href=\"#create-a-table\"></a>Create a table</h3>\n<div class=\"highlight highlight-text-shell-session\"><pre>CREATE TABLE monsters (pet_id timeuuid, name text, description text, PRIMARY KEY (pet_id));</pre></div>\n<p>The user prompt is shown if the command is successful.</p>\n<h3><a id=\"user-content-see-the-newly-created-table\" class=\"anchor\" aria-hidden=\"true\" href=\"#see-the-newly-created-table\"></a>See the newly created table</h3>\n<div class=\"highlight highlight-text-shell-session\"><pre>DESCRIBE TABLES;</pre></div>\n<p>This command will output:</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>monsters\ncqlsh:greek_monsters&gt;</pre></div>\n<h3><a id=\"user-content-insert-data-into-the-table\" class=\"anchor\" aria-hidden=\"true\" href=\"#insert-data-into-the-table\"></a>Insert data into the table</h3>\n<div class=\"highlight highlight-text-shell-session\"><pre>INSERT INTO monsters (pet_id,name,description) VALUES (now(), 'Cerberus (Hellhound)','The three-headed giant hound, that guarded the gates of the Underworld.');\nINSERT INTO monsters (pet_id,name,description) VALUES (now(), 'Orthrus','A two-headed dog, brother of Cerberus, slain by Heracles.');\nINSERT INTO monsters (pet_id,name,description) VALUES (now(), 'Argos','Odysseus faithful dog, known for his speed, strength and his superior tracking skills.');\nINSERT INTO monsters (pet_id,name,description) VALUES (now(), 'Golden Dog','A dog which guarded the infant god Zeus.');\nINSERT INTO monsters (pet_id,name,description) VALUES (now(), 'Guard Dog of Hephaestus Temple','The temple of Hephaestus at Mount Etna was guarded by a pack of sacred dogs.');\nINSERT INTO monsters (pet_id,name,description) VALUES (now(), 'Laelaps',' female dog destined always to catch its prey.');\nINSERT INTO monsters (pet_id,name,description) VALUES (now(), 'Maera','The hound of Erigone, daughter of Icarius of Athens.');</pre></div>\n<p>The user prompt is shown if the command is successful.</p>\n<h3><a id=\"user-content-select-the-data-from-the-table\" class=\"anchor\" aria-hidden=\"true\" href=\"#select-the-data-from-the-table\"></a>Select the data from the table</h3>\n<div class=\"highlight highlight-text-shell-session\"><pre>SELECT * from monsters ;</pre></div>\n<p>Example output:</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>pet_id                               | description                                                                            | name\n--------------------------------------+----------------------------------------------------------------------------------------+--------------------------------\nca3d9f20-6a89-11e8-a0dd-114bb9e30b07 | Odysseus faithful dog, known for his speed, strength and his superior tracking skills. |                          Argos\nca3c3f90-6a89-11e8-a0dd-114bb9e30b07 |                              A two-headed dog, brother of Cerberus, slain by Heracles. |                        Orthrus\nca42f650-6a89-11e8-a0dd-114bb9e30b07 |                                   The hound of Erigone, daughter of Icarius of Athens. |                          Maera\nca3f4cd0-6a89-11e8-a0dd-114bb9e30b07 |                                               A dog which guarded the infant god Zeus. |                     Golden Dog\nca41bdd0-6a89-11e8-a0dd-114bb9e30b07 |                                          female dog destined always to catch its prey. |                        Laelaps\nca40ac60-6a89-11e8-a0dd-114bb9e30b07 |           The temple of Hephaestus at Mount Etna was guarded by a pack of sacred dogs. | Guard Dog of Hephaestus Temple\nca3a6ad0-6a89-11e8-a0dd-114bb9e30b07 |                The three-headed giant hound, that guarded the gates of the Underworld. |           Cerberus (Hellhound)</pre></div>\n<h3><a id=\"user-content-exit\" class=\"anchor\" aria-hidden=\"true\" href=\"#exit\"></a>Exit</h3>\n<p>Exit the pod with the following commands:</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>exit\nexit</pre></div>\n<p>This will return you to your command line.</p>\n<h4><a id=\"user-content-delete-the-deployment\" class=\"anchor\" aria-hidden=\"true\" href=\"#delete-the-deployment\"></a>Delete the deployment</h4>\n<p>Execute the following command to remove the deployment.</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>kubectl delete deployment cass-dev</pre></div>\n<p>The following message is displayed:</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>deployment \"cass-dev\" deleted</pre></div>\n<h2><a id=\"user-content-tear-down\" class=\"anchor\" aria-hidden=\"true\" href=\"#tear-down\"></a>Tear Down</h2>\n<p>The following script will tear down the Cassandra cluster and remove the Kubernetes Engine\ncluster.</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>./delete.sh -c my-cluster-1</pre></div>\n<p>This output will change depending on the cluster name.  In this example the name\n\"my-cluster-1\" was used.</p>\n<p>Replace the text 'my-cluster-1' the name of the cluster that you would like to\nvalidate.  The last lines of the output will be:</p>\n<div class=\"highlight highlight-text-shell-session\"><pre>persistentvolumeclaim \"cassandra-data-cassandra-0\" deleted\npersistentvolumeclaim \"cassandra-data-cassandra-1\" deleted\npersistentvolumeclaim \"cassandra-data-cassandra-2\" deleted\nDeleting cluster</pre></div>\n<p>The tear down script removes all of the components in the manifests directory,\nand it also destroys the cluster.  This script also waits 60 seconds before\nit removes the PVC storage components.</p>\n<h2><a id=\"user-content-troubleshooting\" class=\"anchor\" aria-hidden=\"true\" href=\"#troubleshooting\"></a>Troubleshooting</h2>\n<ol><li>Since we are creating two nodepools in this demo, the cluster may upgrade\nthe control plane and it may go to a \"RECONCILING\" state.  Give the cluster\nsome time and it will scale.  The validate script will fail during this time.</li>\n<li>Run \"gcloud container clusters list\" command to check the cluster status.\nCluster</li>\n<li>If you get errors about quotas, please increase your quota in the project.\nSee <a href=\"https://cloud.google.com/compute/quotas\" rel=\"nofollow\">here</a> for more details.</li>\n<li>A great diagnostic command to run is simply <code>kubectl get pods</code>.  It will show\nthe running pods.</li>\n</ol><p>Initially, the cluster may show as \"RUNNING\" but then go into a \"RECONCILING\" state\nThe symptom will be timeouts when running <code>kubectl get pods</code>\nUse the \"gcloud container clusters list\" command to check the latest state, and wait until it changes back to \"RUNNING\"</p>\n<h2><a id=\"user-content-relevant-materials\" class=\"anchor\" aria-hidden=\"true\" href=\"#relevant-materials\"></a>Relevant Materials</h2>\n<ol><li><a href=\"https://kubernetes.io/blog/2016/07/thousand-instances-of-cassandra-using-kubernetes-pet-set\" rel=\"nofollow\">Thousand Instances of Cassandra</a></li>\n<li><a href=\"https://kubernetes.io/docs/tutorials/stateful-application/basic-stateful-set/\" rel=\"nofollow\">Stateful Sets</a></li>\n<li><a href=\"https://kubernetes.io/docs/concepts/storage/persistent-volumes/\" rel=\"nofollow\">Persistent Volumes</a></li>\n<li><a href=\"https://kubernetes.io/docs/concepts/workloads/pods/disruptions/\" rel=\"nofollow\">Pod Disruption Budgets</a></li>\n<li><a href=\"https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#inter-pod-affinity-and-anti-affinity-beta-feature\" rel=\"nofollow\">Pod Scheduling</a></li>\n<li><a href=\"https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/\" rel=\"nofollow\">Taints and Tolerations</a></li>\n<li><a href=\"https://kubernetes.io/docs/concepts/services-networking/service/#headless-services\" rel=\"nofollow\">Headless Services</a></li>\n<li><a href=\"https://cloud.google.com/compute/quotas\" rel=\"nofollow\">Google Cloud Quotas</a></li>\n<li><a href=\"https://cloud.google.com\" rel=\"nofollow\">Signup for Google Cloud</a></li>\n<li><a href=\"https://cloud.google.com/shell/docs/\" rel=\"nofollow\">Google Cloud Shell</a></li>\n</ol><p><strong>This is not an officially supported Google product</strong></p>\n</article>"}}]}},"pageContext":{"alternative_id":12922}}