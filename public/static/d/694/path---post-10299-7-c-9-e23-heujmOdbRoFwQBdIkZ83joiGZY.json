{"data":{"allAnantCassandralinks":{"edges":[{"node":{"title":"criteo/cassandra_exporter","alternative_id":10299,"content":"<h3>\n      \n      README.md\n    </h3><article class=\"markdown-body entry-content\" itemprop=\"text\">\n<p style=\"text-align: center;\">\n  <a target=\"_blank\" href=\"https://github.com/criteo/cassandra_exporter/raw/master/logo.png\"><img src=\"https://github.com/criteo/cassandra_exporter/raw/master/logo.png\" alt=\"logo\" /></a>\n</p>\n<h2><a id=\"user-content-description\" class=\"anchor\" aria-hidden=\"true\" href=\"#description\"></a>Description</h2>\n<p>Cassandra exporter is a standalone application which exports <a href=\"http://cassandra.apache.org/\" rel=\"nofollow\">Apache Cassandra速</a> metrics throught a prometheus friendly endpoint.\nThis project is originally a fork of <a href=\"https://github.com/prometheus/jmx_exporter\">JMX exporter</a> but aims at an easier integration with <a href=\"http://cassandra.apache.org/\" rel=\"nofollow\">Apache Cassandra速</a>.</p>\n<p>Specifically, this project brings :</p>\n<ul class=\"contains-task-list\"><li class=\"task-list-item\"> Exporting EstimatedHistogram metrics specific to <a href=\"http://cassandra.apache.org/\" rel=\"nofollow\">Apache Cassandra速</a></li>\n<li class=\"task-list-item\"> Filtering on mbean's attributes</li>\n<li class=\"task-list-item\"> Metrics naming that respect the mbean hierarchy</li>\n<li class=\"task-list-item\"> Comprehensive config file</li>\n</ul><p>An essential design choice the project makes is to not let prometheus drive the scraping frequency. This decision has been taken because a lot of <a href=\"http://cassandra.apache.org/\" rel=\"nofollow\">Apache Cassandra速</a> metrics are expensive to scrap and can hinder the performance of the node.\nAs we don't want this kind of situation to happen in production, the scrape frequency is restricted via the configuration of Cassandra Exporter.</p>\n<p><a target=\"_blank\" href=\"https://camo.githubusercontent.com/85f8e6b503fc834c4127aa556d8d941c29b8a1ab/68747470733a2f2f67726166616e612e636f6d2f6170692f64617368626f617264732f363235382f696d616765732f333939362f696d616765\"><img src=\"https://camo.githubusercontent.com/85f8e6b503fc834c4127aa556d8d941c29b8a1ab/68747470733a2f2f67726166616e612e636f6d2f6170692f64617368626f617264732f363235382f696d616765732f333939362f696d616765\" alt=\"Grafana\" data-canonical-src=\"https://grafana.com/api/dashboards/6258/images/3996/image\" /></a>\n<a target=\"_blank\" href=\"https://camo.githubusercontent.com/e9d40a59216424e2a99d8641461c4299925ea44a/68747470733a2f2f67726166616e612e636f6d2f6170692f64617368626f617264732f363430302f696d616765732f343131312f696d616765\"><img src=\"https://camo.githubusercontent.com/e9d40a59216424e2a99d8641461c4299925ea44a/68747470733a2f2f67726166616e612e636f6d2f6170692f64617368626f617264732f363430302f696d616765732f343131312f696d616765\" alt=\"Grafana\" data-canonical-src=\"https://grafana.com/api/dashboards/6400/images/4111/image\" /></a></p>\n<h2><a id=\"user-content-how-to-use\" class=\"anchor\" aria-hidden=\"true\" href=\"#how-to-use\"></a>How to use</h2>\n<p>To start the application</p>\n<blockquote>\n<p>java -jar cassandra_exporter.jar config.yml</p>\n</blockquote>\n<p>The Cassandra exporter needs to run on every Cassandra nodes to get all the informations regarding the whole cluster.</p>\n<p>You can have a look at a full configuration file <a href=\"https://github.com/criteo/cassandra_exporter/blob/master/config.yml\">here</a>\nThe 2 main parts are :</p>\n<ol><li>blacklist</li>\n<li>maxScrapFrequencyInSec</li>\n</ol><p>In the <code>blacklist</code> block, you specify the metrics you don't want the exporter to scrape. This is important as JMX is an RPC mechanism and you don't want to trigger some of those RPC. For example, mbeans endpoint from <code>org:apache:cassandra:db:.*</code> does not expose any metrics but are used to trigger actions on Cassandra's nodes.</p>\n<p>In the <code>maxScrapFrequencyInSec</code>, you specify the metrics you want to be scraped at which frequency.\nBasically, starting from the set of all mbeans, the blacklist is applied first to filter this set and then the <code>maxScrapFrequencyInSec</code> is applied as a whitelist to filter the resulting set.</p>\n<p>As an example, if we take as input set the metrics <code>{a, b, c}</code> and the config file is</p>\n<div class=\"highlight highlight-source-yaml\"><pre>blacklist:\n  - a\nmaxScrapFrequencyInSec:\n  50:\n    - .*\n  3600:\n    - b</pre></div>\n<p>Cassandra Exporter will have the following behavior:</p>\n<ol><li>The metrics matching the blacklisted entries will never be scraped, here the metric <code>a</code> won't be available</li>\n<li>In reverse order of frequency the metrics matching <code>maxScrapFrequencyInSec</code> will be scraped\n<ol><li>Metric <code>b</code> will be scraped every hour</li>\n<li>Remaining metrics will be scrapped every 50s, here only <code>c</code></li>\n</ol></li>\n</ol><p>Resulting in :</p>\n<table><thead><tr><th>Metric</th>\n<th>Scrap Frequency</th>\n</tr></thead><tbody><tr><td>a</td>\n<td>never</td>\n</tr><tr><td>b</td>\n<td>every hour</td>\n</tr><tr><td>c</td>\n<td>every 50 seconds</td>\n</tr></tbody></table><p>Once started the prometheus endpoint will be available at <code>localhost:listenPort/</code> or <code>localhost:listenPort/metrics</code> and metrics format will look like the one below</p>\n<blockquote>\n<p>cassandra_stats{name=\"org:apache:cassandra:metrics:table:biggraphite:datapoints_5760p_3600s_aggr:writelatency:50thpercentile\",} 35.425000000000004</p>\n</blockquote>\n<h2><a id=\"user-content-how-to-debug\" class=\"anchor\" aria-hidden=\"true\" href=\"#how-to-debug\"></a>How to debug</h2>\n<p>Run the program with the following options:</p>\n<blockquote>\n<p>java -Dorg.slf4j.simpleLogger.defaultLogLevel=trace -jar cassandra_exporter.jar config.yml --oneshot</p>\n</blockquote>\n<p>You will get the duration of how long it took to scrape individual MBean, this is useful to understand which metrics are expansive to scrape.</p>\n<p>Goods sources of information to understand what Mbeans are doing/create your dashboards are:</p>\n<ol><li><a href=\"https://cassandra.apache.org/doc/latest/operating/metrics.html\" rel=\"nofollow\">https://cassandra.apache.org/doc/latest/operating/metrics.html</a></li>\n<li><a href=\"https://github.com/apache/cassandra/tree/trunk/src/java/org/apache/cassandra/metrics\">https://github.com/apache/cassandra/tree/trunk/src/java/org/apache/cassandra/metrics</a></li>\n<li><a href=\"http://thelastpickle.com/blog/2017/12/05/datadog-tlp-dashboards.html\" rel=\"nofollow\">http://thelastpickle.com/blog/2017/12/05/datadog-tlp-dashboards.html</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=Q9AAR4UQzMk\" rel=\"nofollow\">https://www.youtube.com/watch?v=Q9AAR4UQzMk</a></li>\n</ol><h2><a id=\"user-content-config-file-example\" class=\"anchor\" aria-hidden=\"true\" href=\"#config-file-example\"></a>Config file example</h2>\n<div class=\"highlight highlight-source-yaml\"><pre>host: localhost:7199\nssl: False\nuser:\npassword:\nlistenPort: 8080\nblacklist:\n   # Unaccessible metrics (not enough privilege)\n   - java:lang:memorypool:.*usagethreshold.*\n   # Leaf attributes not interesting for us but that are presents in many path (reduce cardinality of metrics)\n   - .*:999thpercentile\n   - .*:95thpercentile\n   - .*:fifteenminuterate\n   - .*:fiveminuterate\n   - .*:durationunit\n   - .*:rateunit\n   - .*:stddev\n   - .*:meanrate\n   - .*:mean\n   - .*:min\n   # Path present in many metrics but uninterresting\n   - .*:viewlockacquiretime:.*\n   - .*:viewreadtime:.*\n   - .*:cas[a-z]+latency:.*\n   - .*:colupdatetimedeltahistogram:.*\n   # Mostly for RPC, do not scrap them\n   - org:apache:cassandra:db:.*\n   # columnfamily is an alias for Table metrics in cassandra 3.x\n   # https://github.com/apache/cassandra/blob/8b3a60b9a7dbefeecc06bace617279612ec7092d/src/java/org/apache/cassandra/metrics/TableMetrics.java#L162\n   - org:apache:cassandra:metrics:columnfamily:.*\n   # Should we export metrics for system keyspaces/tables ?\n   - org:apache:cassandra:metrics:[^:]+:system[^:]*:.*\n   # Don't scrape us\n   - com:criteo:nosql:cassandra:exporter:.*\nmaxScrapFrequencyInSec:\n  50:\n    - .*\n  # Refresh those metrics only every hour as it is costly for cassandra to retrieve them\n  3600:\n    - .*:snapshotssize:.*\n    - .*:estimated.*\n    - .*:totaldiskspaceused:.*</pre></div>\n<h2><a id=\"user-content-docker\" class=\"anchor\" aria-hidden=\"true\" href=\"#docker\"></a>Docker</h2>\n<p>You can pull an image directly from <a href=\"https://hub.docker.com/r/criteord/cassandra_exporter/\" rel=\"nofollow\">Dockerhub</a>:</p>\n<pre>docker pull criteord/cassandra_exporter:latest\n</pre>\n<h2><a id=\"user-content-kubernetes\" class=\"anchor\" aria-hidden=\"true\" href=\"#kubernetes\"></a>Kubernetes</h2>\n<p>To get an idea on how to integrate Cassandra Exporter in Kubernetes, you can look at <a href=\"https://github.com/MySocialApp/kubernetes-helm-chart-cassandra\">this helm Chart</a>.</p>\n<h2><a id=\"user-content-grafana\" class=\"anchor\" aria-hidden=\"true\" href=\"#grafana\"></a>Grafana</h2>\n<p>Dedicated dashboards can be <a href=\"https://github.com/criteo/cassandra_exporter/tree/grafana/grafana\">found here</a></p>\n</article>"}}]}},"pageContext":{"alternative_id":10299}}